<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>War Saga Mobile</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a;
            --accent-red: #e63946;
            --text-main: #f1faee;
            --gray-text: #a8a8a8;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Segoe UI', sans-serif;
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        /* HEADER */
        .header {
            background: #000;
            padding: 10px 15px;
            border-bottom: 2px solid var(--accent-red);
        }
        .res-row { display: flex; justify-content: space-around; margin-bottom: 8px; font-size: 1.1em; font-weight: bold; }
        .exp-container { width: 100%; height: 8px; background: #222; border-radius: 4px; overflow: hidden; }
        #exp-fill { height: 100%; background: var(--accent-red); width: 0%; transition: 0.4s; box-shadow: 0 0 8px var(--accent-red); }
        .lvl-info { text-align: center; font-size: 0.75em; color: var(--accent-red); margin-top: 5px; text-transform: uppercase; }

        /* CONTENT */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; }
        .screen { display: none; flex-direction: column; gap: 12px; }
        .screen.active { display: flex; }

        .title { font-size: 1.2em; color: var(--accent-red); margin-bottom: 5px; text-transform: uppercase; border-left: 3px solid var(--accent-red); padding-left: 10px; }

        /* CARDS */
        .card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 15px;
            display: flex; align-items: center; gap: 15px;
            border: 1px solid #2a2a2a;
        }
        .card:active { border-color: var(--accent-red); }
        .card-icon { font-size: 2em; }
        .card-info { flex: 1; }
        .card-info h3 { margin: 0; font-size: 1em; color: #fff; }
        .card-info p { margin: 3px 0 0 0; font-size: 0.8em; color: var(--gray-text); }

        .buy-btn {
            background: var(--accent-red);
            color: white; border: none; padding: 8px 12px;
            border-radius: 6px; font-weight: bold; font-size: 0.8em;
        }
        .bought { background: #333 !important; color: #666 !important; }

        /* NAV */
        .nav {
            position: fixed; bottom: 0; width: 100%;
            background: #000; border-top: 1px solid #222;
            display: flex; padding: 10px 0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { flex: 1; text-align: center; color: #555; font-size: 0.6em; }
        .nav-item.active { color: var(--accent-red); }
        .nav-item span { display: block; font-size: 1.5em; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="res-row">
            <div>ü™ô <span id="gold">50</span></div>
            <div>üíé <span id="emeralds">0</span></div>
        </div>
        <div class="exp-container"><div id="exp-fill"></div></div>
        <div class="lvl-info">–£—Ä–æ–≤–µ–Ω—å <span id="lvl">1</span> | <span id="xp-text">0/100</span> XP</div>
    </div>

    <div class="main-content">
        
        <div id="screen-map" class="screen">
            <h2 class="title">–ö–∞—Ä—Ç–∞</h2>
            <div class="card"><span>üç∫</span><div><h3>–¢–∞–≤–µ—Ä–Ω–∞</h3><p>–°–∫–æ—Ä–æ: –ö–≤–µ—Å—Ç—ã –∏ –Ω–∞–µ–º–Ω–∏–∫–∏</p></div></div>
            <div class="card"><span>‚õ∫</span><div><h3>–õ–∞–≥–µ—Ä—å</h3><p>–°–∫–æ—Ä–æ: –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∞—Ä–º–∏–∏</p></div></div>
            <div class="card"><span>üêé</span><div><h3>–ö–æ–Ω—é—à–Ω—è</h3><p>–°–∫–æ—Ä–æ: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</p></div></div>
        </div>

        <div id="screen-work" class="screen active">
            <h2 class="title">–†–∞–±–æ—Ç–∞</h2>
            <div class="card" onclick="game.doWork('port')">
                <div class="card-icon">üé£</div>
                <div class="card-info">
                    <h3>–ü–æ—Ä—Ç</h3>
                    <p>–î–æ—Ö–æ–¥: +<span id="p-gold">2</span> ü™ô | +5 XP</p>
                </div>
            </div>
            <div class="card" onclick="game.doWork('mine')">
                <div class="card-icon">‚õèÔ∏è</div>
                <div class="card-info">
                    <h3>–†—É–¥–Ω–∏–∫</h3>
                    <p>–î–æ—Ö–æ–¥: +<span id="m-gold">1</span> ü™ô | +8 XP</p>
                    <p style="color:var(--accent-red)">–®–∞–Ω—Å üíé: <span id="m-chance">1</span>%</p>
                </div>
            </div>
        </div>

        <div id="screen-shop" class="screen">
            <h2 class="title">–õ–∞–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</h2>
            <div class="card">
                <div class="card-icon">üéã</div>
                <div class="card-info"><h3>–ë–∞–º–±—É–∫–æ–≤–∞—è —É–¥–æ—á–∫–∞</h3><p>–ü–æ—Ä—Ç: +5 ü™ô</p></div>
                <button id="btn-rod1" class="buy-btn" onclick="game.buy('rod1', 100)">100</button>
            </div>
            <div class="card">
                <div class="card-icon">üî®</div>
                <div class="card-info"><h3>–ñ–µ–ª–µ–∑–Ω–∞—è –∫–∏—Ä–∫–∞</h3><p>–†—É–¥–Ω–∏–∫: +4 ü™ô | 2% üíé</p></div>
                <button id="btn-pick1" class="buy-btn" onclick="game.buy('pick1', 150)">150</button>
            </div>
        </div>

        <div id="screen-bank" class="screen">
            <h2 class="title">–ë–∞–Ω–∫</h2>
            <p style="text-align:center; opacity:0.5; margin-top:20px;">–û–±–º–µ–Ω –∏–∑—É–º—Ä—É–¥–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</p>
        </div>

        <div id="screen-profile" class="screen">
            <h2 class="title">–ì–µ—Ä–æ–π</h2>
            <div class="card">
                <div class="card-icon">üõ°Ô∏è</div>
                <div class="card-info"><h3 id="user-name">–ò–≥—Ä–æ–∫</h3><p>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å: <span id="inv">–ø—É—Å—Ç–æ</span></p></div>
            </div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item" onclick="game.setTab('map', this)"><span>üó∫Ô∏è</span>–ö–∞—Ä—Ç–∞</div>
        <div class="nav-item active" onclick="game.setTab('work', this)"><span>‚öîÔ∏è</span>–†–∞–±–æ—Ç–∞</div>
        <div class="nav-item" onclick="game.setTab('shop', this)"><span>üí∞</span>–õ–∞–≤–∫–∞</div>
        <div class="nav-item" onclick="game.setTab('bank', this)"><span>üè¶</span>–ë–∞–Ω–∫</div>
        <div class="nav-item" onclick="game.setTab('profile', this)"><span>üë§</span>–ì–µ—Ä–æ–π</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const game = {
            gold: 50, emeralds: 0, lvl: 1, xp: 0, nextXp: 100,
            inventory: [],

            setTab(id, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('screen-' + id).classList.add('active');
                el.classList.add('active');
                tg.HapticFeedback.impactOccurred('light');
            },

            doWork(type) {
                if (type === 'port') {
                    let bonus = this.inventory.includes('rod1') ? 5 : 0;
                    this.gold += (2 + bonus);
                    this.addXp(5);
                } else {
                    let bonus = this.inventory.includes('pick1') ? 4 : 0;
                    let chance = this.inventory.includes('pick1') ? 0.02 : 0.01;
                    this.gold += (1 + bonus);
                    if(Math.random() < chance) {
                        this.emeralds++;
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                    this.addXp(8);
                }
                tg.HapticFeedback.impactOccurred('medium');
                this.updateUI();
            },

            addXp(val) {
                this.xp += val;
                if(this.xp >= this.nextXp) {
                    this.xp -= this.nextXp;
                    this.lvl++;
                    this.nextXp = Math.floor(this.nextXp * 1.5 + 50);
                    tg.showAlert("–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: " + this.lvl);
                }
            },

            buy(id, price) {
                if(this.gold >= price && !this.inventory.includes(id)) {
                    this.gold -= price;
                    this.inventory.push(id);
                    const btn = document.getElementById('btn-' + id);
                    btn.innerText = "–ö–£–ü–õ–ï–ù–û";
                    btn.classList.add('bought');
                    this.updateUI();
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!");
                }
            },

            updateUI() {
                document.getElementById('gold').innerText = this.gold;
                document.getElementById('emeralds').innerText = this.emeralds;
                document.getElementById('lvl').innerText = this.lvl;
                document.getElementById('xp-text').innerText = `${this.xp}/${this.nextXp}`;
                document.getElementById('exp-fill').style.width = (this.xp / this.nextXp * 100) + '%';
                
                document.getElementById('p-gold').innerText = this.inventory.includes('rod1') ? 7 : 2;
                document.getElementById('m-gold').innerText = this.inventory.includes('pick1') ? 5 : 1;
                document.getElementById('m-chance').innerText = this.inventory.includes('pick1') ? 2 : 1;
                
                let items = [];
                if(this.inventory.includes('rod1')) items.push("–£–¥–æ—á–∫–∞");
                if(this.inventory.includes('pick1')) items.push("–ö–∏—Ä–∫–∞");
                document.getElementById('inv').innerText = items.length ? items.join(", ") : "–ø—É—Å—Ç–æ";
            }
        };

        if(tg.initDataUnsafe?.user) document.getElementById('user-name').innerText = tg.initDataUnsafe.user.first_name;
        game.updateUI();
    </script>
</body>
</html>
