<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WAR SAGA: ALCHEMY UPDATE</title>
    <link href="https://fonts.googleapis.com/css2?family=Almendra:wght@400;700&family=Cinzel:wght@700;900&family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò (RESET) */
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        :root { --gold: #ffcc00; --gold-dark: #b8860b; --blood: #800000; --parchment: #f4e4bc; --iron: #1a1a1a; --emerald: #00ffcc; }
        body { background: #000; color: var(--parchment); font-family: 'Almendra', serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* –õ–û–ê–î–ï–† */
        #loader { position: fixed; inset: 0; background: radial-gradient(circle, #1a0000 0%, #000 100%); z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.5s; }
        .seal { width: 120px; height: 120px; border: 2px dashed var(--gold); border-radius: 50%; display: flex; justify-content: center; align-items: center; animation: spin 10s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* –®–ê–ü–ö–ê */
        .royal-header { background: linear-gradient(180deg, #1a1a1a 0%, #050505 100%); border-bottom: 2px solid var(--gold-dark); padding: 12px; z-index: 1000; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .stat-vault { background: #000; border: 1px solid var(--gold-dark); padding: 8px; display: flex; align-items: center; gap: 8px; justify-content: center; }
        .val { font-family: 'MedievalSharp', cursive; color: var(--gold); font-size: 1.1em; }
        .exp-bar { height: 12px; background: #111; border: 1px solid var(--gold-dark); position: relative; margin-top: 5px; }
        #exp-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #4b0082, #ff0000); transition: 0.4s; }

        /* –ö–û–ù–¢–ï–ù–¢ */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; background: url('https://www.transparenttextures.com/patterns/dark-matter.png'); }
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –ö–ê–†–¢–û–ß–ö–ò */
        .card { background: rgba(30, 30, 30, 0.9); border: 1px solid #333; border-left: 4px solid var(--gold-dark); margin-bottom: 12px; padding: 15px; display: flex; align-items: center; gap: 15px; }
        .icon-box { width: 50px; height: 50px; background: #000; border: 1px solid var(--gold-dark); display: flex; justify-content: center; align-items: center; font-size: 1.8em; }
        .info h3 { font-family: 'Cinzel', serif; color: var(--gold); font-size: 0.9em; }
        .info p { font-size: 0.8em; color: #888; }

        /* –ö–ù–û–ü–ö–ò */
        .btn { background: linear-gradient(180deg, var(--blood), #400); border: 1px solid var(--gold); color: #fff; padding: 8px 12px; font-family: 'MedievalSharp', cursive; font-size: 0.8em; cursor: pointer; }
        .btn:active { transform: translateY(2px); }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #000; border-top: 2px solid var(--gold-dark); display: flex; z-index: 5000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; font-size: 0.7em; text-transform: uppercase; }
        .nav-item.active { color: var(--gold); background: rgba(184, 134, 11, 0.1); }

        /* –°–ü–ï–¶-–≠–§–§–ï–ö–¢–´ */
        .pop { position: fixed; pointer-events: none; color: var(--gold); font-weight: bold; animation: fly 1s forwards; z-index: 10000; }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 20000; padding: 20px; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="seal"><h1>WS</h1></div>
        <p style="margin-top: 20px; color: var(--gold-dark); letter-spacing: 5px;">WAR SAGA</p>
    </div>

    <header class="royal-header">
        <div class="stats-grid">
            <div class="stat-vault">ü™ô <span id="g-val" class="val">0</span></div>
            <div class="stat-vault">üíé <span id="d-val" class="val">0</span></div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="color: var(--gold); font-weight: bold;">Lvl <span id="l-val">1</span></div>
            <div class="exp-bar" style="flex: 1;"><div id="exp-fill"></div></div>
        </div>
    </header>

    <main class="main-content">
        <section id="scr-work" class="screen active">
            <h2 style="text-align: center; color: var(--gold); margin-bottom: 15px; font-family: 'Cinzel';">–ü–û–î–í–ò–ì–ò</h2>
            <div class="card" onclick="game.work('port', event)">
                <div class="icon-box">üé£</div>
                <div class="info"><h3>–†—ã–±–∞–ª–∫–∞</h3><p>+2 ü™ô | +5 XP</p></div>
            </div>
            <div class="card" onclick="game.work('mine', event)">
                <div class="icon-box">‚õèÔ∏è</div>
                <div class="info"><h3>–†—É–¥–Ω–∏–∫</h3><p>+1 ü™ô | +8 XP</p></div>
            </div>
        </section>

        <section id="scr-shop" class="screen">
            <h2 style="text-align: center; color: var(--gold); margin-bottom: 15px; font-family: 'Cinzel';">–õ–ê–í–ö–ê</h2>
            <div class="card">
                <div class="icon-box">üë®‚Äçüåæ</div>
                <div class="info"><h3>–ö—Ä–µ—Å—Ç—å—è–Ω–∏–Ω</h3><p>+1 ü™ô/—Å–µ–∫</p></div>
                <button class="btn" id="hire1" onclick="game.hire(1, 100)">100</button>
            </div>
            <div class="card">
                <div class="icon-box">üó°Ô∏è</div>
                <div class="info"><h3>–ú–µ—á</h3><p>+2 –∑–æ–ª–æ—Ç–∞ –∑–∞ –∫–ª–∏–∫</p></div>
                <button class="btn" id="buy-sw" onclick="game.buy('sword', 250)">250</button>
            </div>
        </section>

        <section id="scr-hero" class="screen">
            <h2 style="text-align: center; color: var(--gold); margin-bottom: 15px; font-family: 'Cinzel';">–ê–õ–•–ò–ú–ò–Ø</h2>
            <div class="card" style="flex-direction: column; text-align: center;">
                <p>–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å 500 ü™ô –≤ 1 üíé</p>
                <button class="btn" style="margin-top: 10px; width: 100%;" onclick="game.alch('toGem')">–¢–†–ê–ù–°–ú–£–¢–ê–¶–ò–Ø</button>
            </div>
            <div class="card" style="flex-direction: column; text-align: center;">
                <p>–†–∞–∑–±–∏—Ç—å 1 üíé –Ω–∞ 400 ü™ô</p>
                <button class="btn" style="margin-top: 10px; width: 100%;" onclick="game.alch('toGold')">–†–ê–ó–†–£–®–ï–ù–ò–ï</button>
            </div>
        </section>
    </main>

    <nav>
        <div class="nav-item active" onclick="game.tab('work', this)"><span>‚öîÔ∏è</span><br>–ë–∏—Ç–≤–∞</div>
        <div class="nav-item" onclick="game.tab('shop', this)"><span>üí∞</span><br>–õ–∞–≤–∫–∞</div>
        <div class="nav-item" onclick="game.tab('hero', this)"><span>üîÆ</span><br>–ê–ª—Ö–∏–º–∏—è</div>
    </nav>

    <div id="msg-box" class="modal">
        <div style="background: var(--iron); padding: 20px; border: 1px solid var(--gold); text-align: center; width: 80%;">
            <p id="msg-text"></p>
            <button class="btn" style="margin-top: 15px;" onclick="document.getElementById('msg-box').style.display='none'">–û–ö</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const game = {
            s: { gold: 50, gems: 0, lvl: 1, xp: 0, nx: 100, inv: [], w1: 0, inc: 0 },

            init() {
                const save = localStorage.getItem('WS_DATA');
                if (save) this.s = JSON.parse(save);
                tg.expand();
                tg.ready();
                
                // –¢–∞–π–º–µ—Ä –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞
                setInterval(() => {
                    if (this.s.inc > 0) {
                        this.s.gold += this.s.inc;
                        this.upd();
                    }
                }, 1000);

                // –£–±–∏—Ä–∞–µ–º –ª–æ–∞–¥–µ—Ä
                setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 1500);
                this.upd();
            },

            tab(t, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('scr-' + t).classList.add('active');
                el.classList.add('active');
                tg.HapticFeedback.impactOccurred('light');
            },

            work(type, e) {
                let g = (type === 'port' ? 2 : 1) + (this.s.inv.includes('sword') ? 2 : 0);
                let x = (type === 'port' ? 5 : 8);
                this.s.gold += g;
                this.xp(x);
                this.pop(e, `+${g}ü™ô`);
                this.upd();
                tg.HapticFeedback.impactOccurred('medium');
            },

            xp(v) {
                this.s.xp += v;
                if (this.s.xp >= this.s.nx) {
                    this.s.lvl++;
                    this.s.xp = 0;
                    this.s.nx = Math.floor(this.s.nx * 1.6);
                    this.alert("–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω!");
                }
            },

            hire(id, p) {
                const cost = p + (this.s.w1 * 25);
                if (this.s.gold >= cost) {
                    this.s.gold -= cost;
                    this.s.w1++;
                    this.s.inc += 1;
                    this.upd();
                    this.save();
                } else { this.alert("–ú–∞–ª–æ –∑–æ–ª–æ—Ç–∞!"); }
            },

            buy(id, p) {
                if (this.s.inv.includes(id)) return this.alert("–£–∂–µ –∫—É–ø–ª–µ–Ω–æ!");
                if (this.s.gold >= p) {
                    this.s.gold -= p;
                    this.s.inv.push(id);
                    this.upd();
                    this.save();
                } else { this.alert("–ú–∞–ª–æ –∑–æ–ª–æ—Ç–∞!"); }
            },

            alch(mode) {
                if (mode === 'toGem' && this.s.gold >= 500) {
                    this.s.gold -= 500; this.s.gems += 1;
                } else if (mode === 'toGold' && this.s.gems >= 1) {
                    this.s.gems -= 1; this.s.gold += 400;
                } else { return this.alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!"); }
                this.upd(); this.save();
                tg.HapticFeedback.notificationOccurred('success');
            },

            upd() {
                document.getElementById('g-val').innerText = Math.floor(this.s.gold);
                document.getElementById('d-val').innerText = this.s.gems;
                document.getElementById('l-val').innerText = this.s.lvl;
                document.getElementById('exp-fill').style.width = (this.s.xp / this.s.nx * 100) + "%";
                document.getElementById('hire1').innerText = (100 + (this.s.w1 * 25)) + " (–£ –≤–∞—Å: " + this.s.w1 + ")";
                if (this.s.inv.includes('sword')) document.getElementById('buy-sw').innerText = "–ö–£–ü–õ–ï–ù–û";
                this.save();
            },

            pop(e, txt) {
                const p = document.createElement('div');
                p.className = 'pop'; p.innerText = txt;
                p.style.left = (e.clientX || e.touches[0].clientX) + 'px';
                p.style.top = (e.clientY || e.touches[0].clientY) + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 1000);
            },

            alert(m) {
                document.getElementById('msg-text').innerText = m;
                document.getElementById('msg-box').style.display = 'flex';
            },

            save() { localStorage.setItem('WS_DATA', JSON.stringify(this.s)); }
        };

        window.onload = () => game.init();
    </script>
</body>
</html>
