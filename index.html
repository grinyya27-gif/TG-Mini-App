import React, { useState, useEffect, useCallback } from 'react';
import { Users, Briefcase, Package, ShoppingCart, DollarSign, Target, Trophy, Award, Sword, Shield, Hammer, Axe, Crown, Coins, Heart, Zap, Star, TrendingUp, Gift, Lock, CheckCircle, Medal } from 'lucide-react';

const MedievalRPG = () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
  useEffect(() => {
    if (window.Telegram?.WebApp) {
      window.Telegram.WebApp.ready();
      window.Telegram.WebApp.expand();
    }
  }, []);

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
  const getTelegramUser = () => {
    if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
      const user = window.Telegram.WebApp.initDataUnsafe.user;
      return {
        id: user.id,
        username: user.username || '–ü—É—Ç–Ω–∏–∫',
        firstName: user.first_name || '–ü—É—Ç–Ω–∏–∫',
        photoUrl: user.photo_url || null
      };
    }
    return {
      id: Date.now(),
      username: '–ü—É—Ç–Ω–∏–∫',
      firstName: '–ü—É—Ç–Ω–∏–∫',
      photoUrl: null
    };
  };

  const telegramUser = getTelegramUser();

  // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  const initialPlayerState = {
    username: telegramUser.username,
    firstName: telegramUser.firstName,
    photoUrl: telegramUser.photoUrl,
    telegramId: telegramUser.id,
    level: 1,
    exp: 0,
    expToNext: 100,
    gold: 100,
    health: 100,
    maxHealth: 100,
    energy: 100,
    maxEnergy: 100,
    strength: 5,
    intelligence: 5,
    luck: 5,
    totalClicks: 0,
    totalEarned: 0
  };

  // –°–æ—Å—Ç–æ—è–Ω–∏—è
  const [player, setPlayer] = useState(initialPlayerState);
  const [activeTab, setActiveTab] = useState('work');
  const [inventory, setInventory] = useState([]);
  const [equippedItems, setEquippedItems] = useState({
    weapon: null,
    armor: null,
    accessory: null
  });
  const [dailyQuests, setDailyQuests] = useState([]);
  const [achievements, setAchievements] = useState([]);
  const [leaderboard, setLeaderboard] = useState([]);
  const [bankAccount, setBankAccount] = useState({
    balance: 0,
    depositAmount: '',
    withdrawAmount: ''
  });
  const [notifications, setNotifications] = useState([]);
  const [lastWorkTime, setLastWorkTime] = useState({});
  const [clickAnimations, setClickAnimations] = useState([]);

  // –†–∞–±–æ—Ç—ã
  const jobs = [
    { id: 'farmer', name: '–§–µ—Ä–º–µ—Ä', icon: 'üåæ', income: 10, energy: 5, time: 3000, exp: 5 },
    { id: 'miner', name: '–®–∞—Ö—Ç–µ—Ä', icon: '‚õèÔ∏è', income: 15, energy: 8, time: 4000, exp: 8 },
    { id: 'blacksmith', name: '–ö—É–∑–Ω–µ—Ü', icon: '‚öíÔ∏è', income: 25, energy: 12, time: 5000, exp: 12, requiredLevel: 3 },
    { id: 'merchant', name: '–¢–æ—Ä–≥–æ–≤–µ—Ü', icon: 'üí∞', income: 35, energy: 10, time: 6000, exp: 15, requiredLevel: 5 },
    { id: 'hunter', name: '–û—Ö–æ—Ç–Ω–∏–∫', icon: 'üèπ', income: 45, energy: 15, time: 7000, exp: 20, requiredLevel: 8 },
    { id: 'knight', name: '–†—ã—Ü–∞—Ä—å', icon: '‚öîÔ∏è', income: 60, energy: 20, time: 8000, exp: 30, requiredLevel: 12 },
    { id: 'wizard', name: '–ú–∞–≥', icon: 'üîÆ', income: 80, energy: 25, time: 9000, exp: 40, requiredLevel: 15 },
    { id: 'lord', name: '–õ–æ—Ä–¥', icon: 'üëë', income: 120, energy: 30, time: 10000, exp: 60, requiredLevel: 20 }
  ];

  // –ü—Ä–µ–¥–º–µ—Ç—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ
  const marketItems = [
    { id: 'sword1', name: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–µ—á', type: 'weapon', price: 50, strength: 2, icon: 'üó°Ô∏è' },
    { id: 'sword2', name: '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á', type: 'weapon', price: 200, strength: 5, icon: '‚öîÔ∏è', requiredLevel: 5 },
    { id: 'sword3', name: '–°—Ç–∞–ª—å–Ω–æ–π –º–µ—á', type: 'weapon', price: 500, strength: 10, icon: 'üó°Ô∏è', requiredLevel: 10 },
    { id: 'sword4', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—á', type: 'weapon', price: 2000, strength: 25, icon: '‚öîÔ∏è', requiredLevel: 15 },
    { id: 'armor1', name: '–ö–æ–∂–∞–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', price: 80, maxHealth: 20, icon: 'üõ°Ô∏è' },
    { id: 'armor2', name: '–ö–æ–ª—å—á—É–≥–∞', type: 'armor', price: 300, maxHealth: 50, icon: 'üõ°Ô∏è', requiredLevel: 5 },
    { id: 'armor3', name: '–õ–∞—Ç—ã', type: 'armor', price: 800, maxHealth: 100, icon: 'üõ°Ô∏è', requiredLevel: 10 },
    { id: 'armor4', name: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ –ª–∞—Ç—ã', type: 'armor', price: 3000, maxHealth: 200, icon: 'üõ°Ô∏è', requiredLevel: 15 },
    { id: 'ring1', name: '–ö–æ–ª—å—Ü–æ —É–¥–∞—á–∏', type: 'accessory', price: 150, luck: 3, icon: 'üíç' },
    { id: 'ring2', name: '–ê–º—É–ª–µ—Ç —Å–∏–ª—ã', type: 'accessory', price: 400, strength: 5, icon: 'üìø', requiredLevel: 8 },
    { id: 'ring3', name: '–ö–æ—Ä–æ–Ω–∞ –º—É–¥—Ä–æ—Å—Ç–∏', type: 'accessory', price: 1000, intelligence: 10, icon: 'üëë', requiredLevel: 12 },
    { id: 'potion1', name: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', type: 'consumable', price: 30, effect: 'health', value: 50, icon: 'üß™' },
    { id: 'potion2', name: '–ó–µ–ª—å–µ —ç–Ω–µ—Ä–≥–∏–∏', type: 'consumable', effect: 'energy', price: 25, value: 50, icon: '‚ö°' },
    { id: 'potion3', name: '–ó–µ–ª—å–µ –æ–ø—ã—Ç–∞', type: 'consumable', price: 100, effect: 'exp', value: 50, icon: '‚ú®', requiredLevel: 5 }
  ];

  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  const achievementsList = [
    { id: 'clicks100', name: '–ù–æ–≤–∏—á–æ–∫', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 100 –∫–ª–∏–∫–æ–≤', icon: 'üëÜ', requirement: 100, type: 'clicks', reward: 50 },
    { id: 'clicks500', name: '–û–ø—ã—Ç–Ω—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 500 –∫–ª–∏–∫–æ–≤', icon: 'üí™', requirement: 500, type: 'clicks', reward: 200 },
    { id: 'clicks1000', name: '–ú–∞—Å—Ç–µ—Ä —Ç—Ä—É–¥–∞', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 1000 –∫–ª–∏–∫–æ–≤', icon: '‚≠ê', requirement: 1000, type: 'clicks', reward: 500 },
    { id: 'gold1000', name: '–ë–æ–≥–∞—á', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 1000 –∑–æ–ª–æ—Ç–∞', icon: 'üí∞', requirement: 1000, type: 'earned', reward: 100 },
    { id: 'gold5000', name: '–ú–∞–≥–Ω–∞—Ç', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 5000 –∑–æ–ª–æ—Ç–∞', icon: 'üíé', requirement: 5000, type: 'earned', reward: 500 },
    { id: 'level5', name: '–í–æ–∏–Ω 5 —É—Ä–æ–≤–Ω—è', desc: '–î–æ—Å—Ç–∏—á—å 5 —É—Ä–æ–≤–Ω—è', icon: 'üéñÔ∏è', requirement: 5, type: 'level', reward: 200 },
    { id: 'level10', name: '–í–æ–∏–Ω 10 —É—Ä–æ–≤–Ω—è', desc: '–î–æ—Å—Ç–∏—á—å 10 —É—Ä–æ–≤–Ω—è', icon: 'üèÜ', requirement: 10, type: 'level', reward: 500 },
    { id: 'level20', name: '–õ–µ–≥–µ–Ω–¥–∞', desc: '–î–æ—Å—Ç–∏—á—å 20 —É—Ä–æ–≤–Ω—è', icon: 'üëë', requirement: 20, type: 'level', reward: 2000 },
    { id: 'quest10', name: '–ò—Å–∫–∞—Ç–µ–ª—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 10 –∫–≤–µ—Å—Ç–æ–≤', icon: 'üéØ', requirement: 10, type: 'quests', reward: 300 },
    { id: 'quest50', name: '–ì–µ—Ä–æ–π –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–∞', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 50 –∫–≤–µ—Å—Ç–æ–≤', icon: '‚öîÔ∏è', requirement: 50, type: 'quests', reward: 1000 }
  ];

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤
  const generateDailyQuests = useCallback(() => {
    const quests = [
      { id: 1, name: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 100 –∑–æ–ª–æ—Ç–∞', type: 'earn', target: 100, current: 0, reward: 50, exp: 20, icon: 'üí∞' },
      { id: 2, name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 20 —Ä–∞–±–æ—Ç', type: 'work', target: 20, current: 0, reward: 80, exp: 30, icon: '‚öíÔ∏è' },
      { id: 3, name: '–ö—É–ø–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –º–∞–≥–∞–∑–∏–Ω–µ', type: 'buy', target: 1, current: 0, reward: 40, exp: 15, icon: 'üõí' },
      { id: 4, name: '–î–æ—Å—Ç–∏—á—å –ø–æ–ª–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏', type: 'energy', target: 1, current: 0, reward: 30, exp: 10, icon: '‚ö°' },
      { id: 5, name: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 50 –æ–ø—ã—Ç–∞', type: 'exp', target: 50, current: 0, reward: 60, exp: 25, icon: '‚≠ê' }
    ];
    
    // –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–≤–µ—Å—Ç–∞
    const shuffled = quests.sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 3);
  }, []);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    const loadGame = async () => {
      try {
        const savedPlayer = await window.storage.get('player');
        const savedInventory = await window.storage.get('inventory');
        const savedEquipped = await window.storage.get('equipped');
        const savedQuests = await window.storage.get('dailyQuests');
        const savedAchievements = await window.storage.get('achievements');
        const savedBank = await window.storage.get('bank');
        const savedLeaderboard = await window.storage.get('leaderboard', true);
        const savedLastWork = await window.storage.get('lastWorkTime');

        if (savedPlayer) {
          const playerData = JSON.parse(savedPlayer.value);
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram
          playerData.username = telegramUser.username;
          playerData.firstName = telegramUser.firstName;
          playerData.photoUrl = telegramUser.photoUrl;
          playerData.telegramId = telegramUser.id;
          setPlayer(playerData);
        }
        if (savedInventory) setInventory(JSON.parse(savedInventory.value));
        if (savedEquipped) setEquippedItems(JSON.parse(savedEquipped.value));
        if (savedQuests) setDailyQuests(JSON.parse(savedQuests.value));
        else setDailyQuests(generateDailyQuests());
        if (savedAchievements) setAchievements(JSON.parse(savedAchievements.value));
        if (savedBank) setBankAccount(JSON.parse(savedBank.value));
        if (savedLeaderboard) setLeaderboard(JSON.parse(savedLeaderboard.value));
        if (savedLastWork) setLastWorkTime(JSON.parse(savedLastWork.value));
      } catch (err) {
        console.log('–ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É');
        setDailyQuests(generateDailyQuests());
      }
    };
    loadGame();
  }, [generateDailyQuests, telegramUser]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    const saveGame = async () => {
      try {
        await window.storage.set('player', JSON.stringify(player));
        await window.storage.set('inventory', JSON.stringify(inventory));
        await window.storage.set('equipped', JSON.stringify(equippedItems));
        await window.storage.set('dailyQuests', JSON.stringify(dailyQuests));
        await window.storage.set('achievements', JSON.stringify(achievements));
        await window.storage.set('bank', JSON.stringify(bankAccount));
        await window.storage.set('lastWorkTime', JSON.stringify(lastWorkTime));
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–æ–±—â–∏–π –¥–æ—Å—Ç—É–ø)
        const newLeaderboard = [...leaderboard];
        const playerIndex = newLeaderboard.findIndex(p => p.telegramId === player.telegramId);
        const playerData = {
          telegramId: player.telegramId,
          username: player.username,
          level: player.level,
          gold: player.gold,
          totalEarned: player.totalEarned,
          photoUrl: player.photoUrl
        };
        
        if (playerIndex >= 0) {
          newLeaderboard[playerIndex] = playerData;
        } else {
          newLeaderboard.push(playerData);
        }
        
        newLeaderboard.sort((a, b) => b.totalEarned - a.totalEarned);
        const top100 = newLeaderboard.slice(0, 100);
        
        await window.storage.set('leaderboard', JSON.stringify(top100), true);
        setLeaderboard(top100);
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', err);
      }
    };
    saveGame();
  }, [player, inventory, equippedItems, dailyQuests, achievements, bankAccount, lastWorkTime]);

  // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  const addNotification = (message, type = 'success') => {
    const id = Date.now();
    setNotifications(prev => [...prev, { id, message, type }]);
    setTimeout(() => {
      setNotifications(prev => prev.filter(n => n.id !== id));
    }, 3000);
  };

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–ª–∏–∫–∞
  const addClickAnimation = (x, y, text) => {
    const id = Date.now();
    setClickAnimations(prev => [...prev, { id, x, y, text }]);
    setTimeout(() => {
      setClickAnimations(prev => prev.filter(a => a.id !== id));
    }, 1000);
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  const checkAchievements = useCallback((newPlayer) => {
    achievementsList.forEach(achievement => {
      if (achievements.includes(achievement.id)) return;

      let unlocked = false;
      switch (achievement.type) {
        case 'clicks':
          unlocked = newPlayer.totalClicks >= achievement.requirement;
          break;
        case 'earned':
          unlocked = newPlayer.totalEarned >= achievement.requirement;
          break;
        case 'level':
          unlocked = newPlayer.level >= achievement.requirement;
          break;
        case 'quests':
          const completedQuests = dailyQuests.filter(q => q.completed).length;
          unlocked = completedQuests >= achievement.requirement;
          break;
        default:
          break;
      }

      if (unlocked) {
        setAchievements(prev => [...prev, achievement.id]);
        setPlayer(p => ({ ...p, gold: p.gold + achievement.reward }));
        addNotification(`üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.name}! +${achievement.reward} –∑–æ–ª–æ—Ç–∞`, 'achievement');
      }
    });
  }, [achievements, dailyQuests]);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤
  const updateQuest = useCallback((type, amount = 1) => {
    setDailyQuests(prev => prev.map(quest => {
      if (quest.type === type && !quest.completed) {
        const newCurrent = quest.current + amount;
        const completed = newCurrent >= quest.target;
        
        if (completed && !quest.completed) {
          setPlayer(p => ({
            ...p,
            gold: p.gold + quest.reward,
            exp: p.exp + quest.exp
          }));
          addNotification(`‚úÖ –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω: ${quest.name}! +${quest.reward} –∑–æ–ª–æ—Ç–∞`, 'success');
        }
        
        return { ...quest, current: Math.min(newCurrent, quest.target), completed };
      }
      return quest;
    }));
  }, []);

  // –†–∞–±–æ—Ç–∞
  const performWork = (job) => {
    const now = Date.now();
    const lastTime = lastWorkTime[job.id] || 0;
    
    if (now - lastTime < job.time) {
      const remaining = Math.ceil((job.time - (now - lastTime)) / 1000);
      addNotification(`‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${remaining} —Å–µ–∫`, 'warning');
      return;
    }

    if (player.energy < job.energy) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏', 'error');
      return;
    }

    if (job.requiredLevel && player.level < job.requiredLevel) {
      addNotification(`‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è ${job.requiredLevel} —É—Ä–æ–≤–µ–Ω—å`, 'error');
      return;
    }

    const bonus = Math.floor(job.income * (player.strength / 100));
    const totalIncome = job.income + bonus;

    setPlayer(prev => {
      const newExp = prev.exp + job.exp;
      const newLevel = newExp >= prev.expToNext ? prev.level + 1 : prev.level;
      const newExpToNext = newLevel > prev.level ? prev.expToNext * 1.5 : prev.expToNext;
      
      const newPlayer = {
        ...prev,
        gold: prev.gold + totalIncome,
        energy: prev.energy - job.energy,
        exp: newLevel > prev.level ? newExp - prev.expToNext : newExp,
        level: newLevel,
        expToNext: newExpToNext,
        totalClicks: prev.totalClicks + 1,
        totalEarned: prev.totalEarned + totalIncome,
        maxHealth: newLevel > prev.level ? prev.maxHealth + 10 : prev.maxHealth,
        maxEnergy: newLevel > prev.level ? prev.maxEnergy + 5 : prev.maxEnergy,
        strength: newLevel > prev.level ? prev.strength + 1 : prev.strength,
        intelligence: newLevel > prev.level ? prev.intelligence + 1 : prev.intelligence
      };

      if (newLevel > prev.level) {
        addNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –¢–µ–ø–µ—Ä—å ${newLevel} —É—Ä–æ–≤–µ–Ω—å`, 'success');
      }

      checkAchievements(newPlayer);
      return newPlayer;
    });

    setLastWorkTime(prev => ({ ...prev, [job.id]: now }));
    updateQuest('work');
    updateQuest('earn', totalIncome);
    updateQuest('exp', job.exp);
    
    addClickAnimation(
      Math.random() * 200 + 100,
      Math.random() * 100 + 100,
      `+${totalIncome} üí∞`
    );
    addNotification(`${job.icon} +${totalIncome} –∑–æ–ª–æ—Ç–∞`, 'success');
  };

  // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  const buyItem = (item) => {
    if (player.gold < item.price) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞', 'error');
      return;
    }

    if (item.requiredLevel && player.level < item.requiredLevel) {
      addNotification(`‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è ${item.requiredLevel} —É—Ä–æ–≤–µ–Ω—å`, 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold - item.price }));
    setInventory(prev => [...prev, { ...item, id: Date.now() }]);
    updateQuest('buy');
    addNotification(`‚úÖ –ö—É–ø–ª–µ–Ω–æ: ${item.name}`, 'success');
  };

  // –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  const equipItem = (item) => {
    if (item.type === 'consumable') {
      useConsumable(item);
      return;
    }

    const oldItem = equippedItems[item.type];
    
    setEquippedItems(prev => ({ ...prev, [item.type]: item }));
    setInventory(prev => {
      const filtered = prev.filter(i => i.id !== item.id);
      return oldItem ? [...filtered, oldItem] : filtered;
    });

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã
    setPlayer(prev => {
      let newStats = { ...prev };
      
      // –£–±–∏—Ä–∞–µ–º –±–æ–Ω—É—Å—ã —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      if (oldItem) {
        if (oldItem.strength) newStats.strength -= oldItem.strength;
        if (oldItem.intelligence) newStats.intelligence -= oldItem.intelligence;
        if (oldItem.luck) newStats.luck -= oldItem.luck;
        if (oldItem.maxHealth) newStats.maxHealth -= oldItem.maxHealth;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      if (item.strength) newStats.strength += item.strength;
      if (item.intelligence) newStats.intelligence += item.intelligence;
      if (item.luck) newStats.luck += item.luck;
      if (item.maxHealth) newStats.maxHealth += item.maxHealth;
      
      return newStats;
    });

    addNotification(`‚úÖ –≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ: ${item.name}`, 'success');
  };

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∞
  const useConsumable = (item) => {
    setPlayer(prev => {
      let newStats = { ...prev };
      switch (item.effect) {
        case 'health':
          newStats.health = Math.min(prev.health + item.value, prev.maxHealth);
          break;
        case 'energy':
          newStats.energy = Math.min(prev.energy + item.value, prev.maxEnergy);
          if (newStats.energy === newStats.maxEnergy) updateQuest('energy');
          break;
        case 'exp':
          newStats.exp += item.value;
          break;
        default:
          break;
      }
      return newStats;
    });

    setInventory(prev => prev.filter(i => i.id !== item.id));
    addNotification(`‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${item.name}`, 'success');
  };

  // –°–Ω—è—Ç–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
  const unequipItem = (type) => {
    const item = equippedItems[type];
    if (!item) return;

    setEquippedItems(prev => ({ ...prev, [type]: null }));
    setInventory(prev => [...prev, item]);

    // –£–±–∏—Ä–∞–µ–º –±–æ–Ω—É—Å—ã
    setPlayer(prev => {
      let newStats = { ...prev };
      if (item.strength) newStats.strength -= item.strength;
      if (item.intelligence) newStats.intelligence -= item.intelligence;
      if (item.luck) newStats.luck -= item.luck;
      if (item.maxHealth) newStats.maxHealth -= item.maxHealth;
      return newStats;
    });

    addNotification(`‚úÖ –°–Ω—è—Ç–æ: ${item.name}`, 'success');
  };

  // –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  const depositToBank = () => {
    const amount = parseInt(bankAccount.depositAmount);
    if (isNaN(amount) || amount <= 0) {
      addNotification('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞', 'error');
      return;
    }
    if (player.gold < amount) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞', 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold - amount }));
    setBankAccount(prev => ({ ...prev, balance: prev.balance + amount, depositAmount: '' }));
    addNotification(`‚úÖ –í–Ω–µ—Å–µ–Ω–æ ${amount} –∑–æ–ª–æ—Ç–∞ –≤ –±–∞–Ω–∫`, 'success');
  };

  const withdrawFromBank = () => {
    const amount = parseInt(bankAccount.withdrawAmount);
    if (isNaN(amount) || amount <= 0) {
      addNotification('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞', 'error');
      return;
    }
    if (bankAccount.balance < amount) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –±–∞–Ω–∫–µ', 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold + amount }));
    setBankAccount(prev => ({ ...prev, balance: prev.balance - amount, withdrawAmount: '' }));
    addNotification(`‚úÖ –°–Ω—è—Ç–æ ${amount} –∑–æ–ª–æ—Ç–∞ –∏–∑ –±–∞–Ω–∫–∞`, 'success');
  };

  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
  useEffect(() => {
    const interval = setInterval(() => {
      setPlayer(prev => {
        if (prev.energy < prev.maxEnergy) {
          const newEnergy = Math.min(prev.energy + 1, prev.maxEnergy);
          if (newEnergy === prev.maxEnergy) updateQuest('energy');
          return { ...prev, energy: newEnergy };
        }
        return prev;
      });
    }, 5000);

    return () => clearInterval(interval);
  }, [updateQuest]);

  // –†–µ–Ω–¥–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  const renderProfile = () => (
    <div className="space-y-4">
      <div className="bg-gray-800 rounded-lg p-6 border-2 border-red-900">
        <div className="flex items-center space-x-4 mb-4">
          {player.photoUrl ? (
            <img src={player.photoUrl} alt="Avatar" className="w-20 h-20 rounded-full border-2 border-red-500" />
          ) : (
            <div className="w-20 h-20 rounded-full bg-red-900 flex items-center justify-center border-2 border-red-500">
              <Users className="w-10 h-10 text-red-300" />
            </div>
          )}
          <div className="flex-1">
            <h2 className="text-2xl font-bold text-red-400">{player.firstName}</h2>
            <p className="text-gray-400">@{player.username}</p>
            <div className="flex items-center space-x-2 mt-2">
              <Crown className="w-5 h-5 text-yellow-500" />
              <span className="text-white font-semibold">–£—Ä–æ–≤–µ–Ω—å {player.level}</span>
            </div>
          </div>
        </div>

        <div className="space-y-3">
          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400">–û–ø—ã—Ç</span>
              <span className="text-red-400">{Math.floor(player.exp)}/{Math.floor(player.expToNext)}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-red-500 h-2 rounded-full transition-all" style={{ width: `${(player.exp / player.expToNext) * 100}%` }}></div>
            </div>
          </div>

          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400 flex items-center"><Heart className="w-4 h-4 mr-1" />–ó–¥–æ—Ä–æ–≤—å–µ</span>
              <span className="text-red-400">{player.health}/{player.maxHealth}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-red-600 h-2 rounded-full transition-all" style={{ width: `${(player.health / player.maxHealth) * 100}%` }}></div>
            </div>
          </div>

          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400 flex items-center"><Zap className="w-4 h-4 mr-1" />–≠–Ω–µ—Ä–≥–∏—è</span>
              <span className="text-red-400">{player.energy}/{player.maxEnergy}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-yellow-500 h-2 rounded-full transition-all" style={{ width: `${(player.energy / player.maxEnergy) * 100}%` }}></div>
            </div>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
          <div className="flex items-center justify-between mb-2">
            <Coins className="w-6 h-6 text-yellow-500" />
            <span className="text-gray-400 text-sm">–ó–æ–ª–æ—Ç–æ</span>
          </div>
          <p className="text-2xl font-bold text-yellow-400">{player.gold}</p>
        </div>

        <div className
            import React, { useState, useEffect, useCallback } from 'react';
import { Users, Briefcase, Package, ShoppingCart, DollarSign, Target, Trophy, Award, Sword, Shield, Hammer, Axe, Crown, Coins, Heart, Zap, Star, TrendingUp, Gift, Lock, CheckCircle, Medal } from 'lucide-react';

const MedievalRPG = () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
  useEffect(() => {
    if (window.Telegram?.WebApp) {
      window.Telegram.WebApp.ready();
      window.Telegram.WebApp.expand();
    }
  }, []);

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
  const getTelegramUser = () => {
    if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
      const user = window.Telegram.WebApp.initDataUnsafe.user;
      return {
        id: user.id,
        username: user.username || '–ü—É—Ç–Ω–∏–∫',
        firstName: user.first_name || '–ü—É—Ç–Ω–∏–∫',
        photoUrl: user.photo_url || null
      };
    }
    return {
      id: Date.now(),
      username: '–ü—É—Ç–Ω–∏–∫',
      firstName: '–ü—É—Ç–Ω–∏–∫',
      photoUrl: null
    };
  };

  const telegramUser = getTelegramUser();

  // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  const initialPlayerState = {
    username: telegramUser.username,
    firstName: telegramUser.firstName,
    photoUrl: telegramUser.photoUrl,
    telegramId: telegramUser.id,
    level: 1,
    exp: 0,
    expToNext: 100,
    gold: 100,
    health: 100,
    maxHealth: 100,
    energy: 100,
    maxEnergy: 100,
    strength: 5,
    intelligence: 5,
    luck: 5,
    totalClicks: 0,
    totalEarned: 0
  };

  // –°–æ—Å—Ç–æ—è–Ω–∏—è
  const [player, setPlayer] = useState(initialPlayerState);
  const [activeTab, setActiveTab] = useState('work');
  const [inventory, setInventory] = useState([]);
  const [equippedItems, setEquippedItems] = useState({
    weapon: null,
    armor: null,
    accessory: null
  });
  const [dailyQuests, setDailyQuests] = useState([]);
  const [achievements, setAchievements] = useState([]);
  const [leaderboard, setLeaderboard] = useState([]);
  const [bankAccount, setBankAccount] = useState({
    balance: 0,
    depositAmount: '',
    withdrawAmount: ''
  });
  const [notifications, setNotifications] = useState([]);
  const [lastWorkTime, setLastWorkTime] = useState({});
  const [clickAnimations, setClickAnimations] = useState([]);

  // –†–∞–±–æ—Ç—ã
  const jobs = [
    { id: 'farmer', name: '–§–µ—Ä–º–µ—Ä', icon: 'üåæ', income: 10, energy: 5, time: 3000, exp: 5 },
    { id: 'miner', name: '–®–∞—Ö—Ç–µ—Ä', icon: '‚õèÔ∏è', income: 15, energy: 8, time: 4000, exp: 8 },
    { id: 'blacksmith', name: '–ö—É–∑–Ω–µ—Ü', icon: '‚öíÔ∏è', income: 25, energy: 12, time: 5000, exp: 12, requiredLevel: 3 },
    { id: 'merchant', name: '–¢–æ—Ä–≥–æ–≤–µ—Ü', icon: 'üí∞', income: 35, energy: 10, time: 6000, exp: 15, requiredLevel: 5 },
    { id: 'hunter', name: '–û—Ö–æ—Ç–Ω–∏–∫', icon: 'üèπ', income: 45, energy: 15, time: 7000, exp: 20, requiredLevel: 8 },
    { id: 'knight', name: '–†—ã—Ü–∞—Ä—å', icon: '‚öîÔ∏è', income: 60, energy: 20, time: 8000, exp: 30, requiredLevel: 12 },
    { id: 'wizard', name: '–ú–∞–≥', icon: 'üîÆ', income: 80, energy: 25, time: 9000, exp: 40, requiredLevel: 15 },
    { id: 'lord', name: '–õ–æ—Ä–¥', icon: 'üëë', income: 120, energy: 30, time: 10000, exp: 60, requiredLevel: 20 }
  ];

  // –ü—Ä–µ–¥–º–µ—Ç—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ
  const marketItems = [
    { id: 'sword1', name: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–µ—á', type: 'weapon', price: 50, strength: 2, icon: 'üó°Ô∏è' },
    { id: 'sword2', name: '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á', type: 'weapon', price: 200, strength: 5, icon: '‚öîÔ∏è', requiredLevel: 5 },
    { id: 'sword3', name: '–°—Ç–∞–ª—å–Ω–æ–π –º–µ—á', type: 'weapon', price: 500, strength: 10, icon: 'üó°Ô∏è', requiredLevel: 10 },
    { id: 'sword4', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—á', type: 'weapon', price: 2000, strength: 25, icon: '‚öîÔ∏è', requiredLevel: 15 },
    { id: 'armor1', name: '–ö–æ–∂–∞–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', price: 80, maxHealth: 20, icon: 'üõ°Ô∏è' },
    { id: 'armor2', name: '–ö–æ–ª—å—á—É–≥–∞', type: 'armor', price: 300, maxHealth: 50, icon: 'üõ°Ô∏è', requiredLevel: 5 },
    { id: 'armor3', name: '–õ–∞—Ç—ã', type: 'armor', price: 800, maxHealth: 100, icon: 'üõ°Ô∏è', requiredLevel: 10 },
    { id: 'armor4', name: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ –ª–∞—Ç—ã', type: 'armor', price: 3000, maxHealth: 200, icon: 'üõ°Ô∏è', requiredLevel: 15 },
    { id: 'ring1', name: '–ö–æ–ª—å—Ü–æ —É–¥–∞—á–∏', type: 'accessory', price: 150, luck: 3, icon: 'üíç' },
    { id: 'ring2', name: '–ê–º—É–ª–µ—Ç —Å–∏–ª—ã', type: 'accessory', price: 400, strength: 5, icon: 'üìø', requiredLevel: 8 },
    { id: 'ring3', name: '–ö–æ—Ä–æ–Ω–∞ –º—É–¥—Ä–æ—Å—Ç–∏', type: 'accessory', price: 1000, intelligence: 10, icon: 'üëë', requiredLevel: 12 },
    { id: 'potion1', name: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', type: 'consumable', price: 30, effect: 'health', value: 50, icon: 'üß™' },
    { id: 'potion2', name: '–ó–µ–ª—å–µ —ç–Ω–µ—Ä–≥–∏–∏', type: 'consumable', effect: 'energy', price: 25, value: 50, icon: '‚ö°' },
    { id: 'potion3', name: '–ó–µ–ª—å–µ –æ–ø—ã—Ç–∞', type: 'consumable', price: 100, effect: 'exp', value: 50, icon: '‚ú®', requiredLevel: 5 }
  ];

  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  const achievementsList = [
    { id: 'clicks100', name: '–ù–æ–≤–∏—á–æ–∫', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 100 –∫–ª–∏–∫–æ–≤', icon: 'üëÜ', requirement: 100, type: 'clicks', reward: 50 },
    { id: 'clicks500', name: '–û–ø—ã—Ç–Ω—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 500 –∫–ª–∏–∫–æ–≤', icon: 'üí™', requirement: 500, type: 'clicks', reward: 200 },
    { id: 'clicks1000', name: '–ú–∞—Å—Ç–µ—Ä —Ç—Ä—É–¥–∞', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 1000 –∫–ª–∏–∫–æ–≤', icon: '‚≠ê', requirement: 1000, type: 'clicks', reward: 500 },
    { id: 'gold1000', name: '–ë–æ–≥–∞—á', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 1000 –∑–æ–ª–æ—Ç–∞', icon: 'üí∞', requirement: 1000, type: 'earned', reward: 100 },
    { id: 'gold5000', name: '–ú–∞–≥–Ω–∞—Ç', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 5000 –∑–æ–ª–æ—Ç–∞', icon: 'üíé', requirement: 5000, type: 'earned', reward: 500 },
    { id: 'level5', name: '–í–æ–∏–Ω 5 —É—Ä–æ–≤–Ω—è', desc: '–î–æ—Å—Ç–∏—á—å 5 —É—Ä–æ–≤–Ω—è', icon: 'üéñÔ∏è', requirement: 5, type: 'level', reward: 200 },
    { id: 'level10', name: '–í–æ–∏–Ω 10 —É—Ä–æ–≤–Ω—è', desc: '–î–æ—Å—Ç–∏—á—å 10 —É—Ä–æ–≤–Ω—è', icon: 'üèÜ', requirement: 10, type: 'level', reward: 500 },
    { id: 'level20', name: '–õ–µ–≥–µ–Ω–¥–∞', desc: '–î–æ—Å—Ç–∏—á—å 20 —É—Ä–æ–≤–Ω—è', icon: 'üëë', requirement: 20, type: 'level', reward: 2000 },
    { id: 'quest10', name: '–ò—Å–∫–∞—Ç–µ–ª—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 10 –∫–≤–µ—Å—Ç–æ–≤', icon: 'üéØ', requirement: 10, type: 'quests', reward: 300 },
    { id: 'quest50', name: '–ì–µ—Ä–æ–π –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–∞', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 50 –∫–≤–µ—Å—Ç–æ–≤', icon: '‚öîÔ∏è', requirement: 50, type: 'quests', reward: 1000 }
  ];

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤
  const generateDailyQuests = useCallback(() => {
    const quests = [
      { id: 1, name: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 100 –∑–æ–ª–æ—Ç–∞', type: 'earn', target: 100, current: 0, reward: 50, exp: 20, icon: 'üí∞' },
      { id: 2, name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 20 —Ä–∞–±–æ—Ç', type: 'work', target: 20, current: 0, reward: 80, exp: 30, icon: '‚öíÔ∏è' },
      { id: 3, name: '–ö—É–ø–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –º–∞–≥–∞–∑–∏–Ω–µ', type: 'buy', target: 1, current: 0, reward: 40, exp: 15, icon: 'üõí' },
      { id: 4, name: '–î–æ—Å—Ç–∏—á—å –ø–æ–ª–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏', type: 'energy', target: 1, current: 0, reward: 30, exp: 10, icon: '‚ö°' },
      { id: 5, name: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 50 –æ–ø—ã—Ç–∞', type: 'exp', target: 50, current: 0, reward: 60, exp: 25, icon: '‚≠ê' }
    ];
    
    // –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–≤–µ—Å—Ç–∞
    const shuffled = quests.sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 3);
  }, []);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    const loadGame = async () => {
      try {
        const savedPlayer = await window.storage.get('player');
        const savedInventory = await window.storage.get('inventory');
        const savedEquipped = await window.storage.get('equipped');
        const savedQuests = await window.storage.get('dailyQuests');
        const savedAchievements = await window.storage.get('achievements');
        const savedBank = await window.storage.get('bank');
        const savedLeaderboard = await window.storage.get('leaderboard', true);
        const savedLastWork = await window.storage.get('lastWorkTime');

        if (savedPlayer) {
          const playerData = JSON.parse(savedPlayer.value);
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram
          playerData.username = telegramUser.username;
          playerData.firstName = telegramUser.firstName;
          playerData.photoUrl = telegramUser.photoUrl;
          playerData.telegramId = telegramUser.id;
          setPlayer(playerData);
        }
        if (savedInventory) setInventory(JSON.parse(savedInventory.value));
        if (savedEquipped) setEquippedItems(JSON.parse(savedEquipped.value));
        if (savedQuests) setDailyQuests(JSON.parse(savedQuests.value));
        else setDailyQuests(generateDailyQuests());
        if (savedAchievements) setAchievements(JSON.parse(savedAchievements.value));
        if (savedBank) setBankAccount(JSON.parse(savedBank.value));
        if (savedLeaderboard) setLeaderboard(JSON.parse(savedLeaderboard.value));
        if (savedLastWork) setLastWorkTime(JSON.parse(savedLastWork.value));
      } catch (err) {
        console.log('–ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É');
        setDailyQuests(generateDailyQuests());
      }
    };
    loadGame();
  }, [generateDailyQuests, telegramUser]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    const saveGame = async () => {
      try {
        await window.storage.set('player', JSON.stringify(player));
        await window.storage.set('inventory', JSON.stringify(inventory));
        await window.storage.set('equipped', JSON.stringify(equippedItems));
        await window.storage.set('dailyQuests', JSON.stringify(dailyQuests));
        await window.storage.set('achievements', JSON.stringify(achievements));
        await window.storage.set('bank', JSON.stringify(bankAccount));
        await window.storage.set('lastWorkTime', JSON.stringify(lastWorkTime));
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–æ–±—â–∏–π –¥–æ—Å—Ç—É–ø)
        const newLeaderboard = [...leaderboard];
        const playerIndex = newLeaderboard.findIndex(p => p.telegramId === player.telegramId);
        const playerData = {
          telegramId: player.telegramId,
          username: player.username,
          level: player.level,
          gold: player.gold,
          totalEarned: player.totalEarned,
          photoUrl: player.photoUrl
        };
        
        if (playerIndex >= 0) {
          newLeaderboard[playerIndex] = playerData;
        } else {
          newLeaderboard.push(playerData);
        }
        
        newLeaderboard.sort((a, b) => b.totalEarned - a.totalEarned);
        const top100 = newLeaderboard.slice(0, 100);
        
        await window.storage.set('leaderboard', JSON.stringify(top100), true);
        setLeaderboard(top100);
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', err);
      }
    };
    saveGame();
  }, [player, inventory, equippedItems, dailyQuests, achievements, bankAccount, lastWorkTime]);

  // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  const addNotification = (message, type = 'success') => {
    const id = Date.now();
    setNotifications(prev => [...prev, { id, message, type }]);
    setTimeout(() => {
      setNotifications(prev => prev.filter(n => n.id !== id));
    }, 3000);
  };

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–ª–∏–∫–∞
  const addClickAnimation = (x, y, text) => {
    const id = Date.now();
    setClickAnimations(prev => [...prev, { id, x, y, text }]);
    setTimeout(() => {
      setClickAnimations(prev => prev.filter(a => a.id !== id));
    }, 1000);
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  const checkAchievements = useCallback((newPlayer) => {
    achievementsList.forEach(achievement => {
      if (achievements.includes(achievement.id)) return;

      let unlocked = false;
      switch (achievement.type) {
        case 'clicks':
          unlocked = newPlayer.totalClicks >= achievement.requirement;
          break;
        case 'earned':
          unlocked = newPlayer.totalEarned >= achievement.requirement;
          break;
        case 'level':
          unlocked = newPlayer.level >= achievement.requirement;
          break;
        case 'quests':
          const completedQuests = dailyQuests.filter(q => q.completed).length;
          unlocked = completedQuests >= achievement.requirement;
          break;
        default:
          break;
      }

      if (unlocked) {
        setAchievements(prev => [...prev, achievement.id]);
        setPlayer(p => ({ ...p, gold: p.gold + achievement.reward }));
        addNotification(`üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.name}! +${achievement.reward} –∑–æ–ª–æ—Ç–∞`, 'achievement');
      }
    });
  }, [achievements, dailyQuests]);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤
  const updateQuest = useCallback((type, amount = 1) => {
    setDailyQuests(prev => prev.map(quest => {
      if (quest.type === type && !quest.completed) {
        const newCurrent = quest.current + amount;
        const completed = newCurrent >= quest.target;
        
        if (completed && !quest.completed) {
          setPlayer(p => ({
            ...p,
            gold: p.gold + quest.reward,
            exp: p.exp + quest.exp
          }));
          addNotification(`‚úÖ –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω: ${quest.name}! +${quest.reward} –∑–æ–ª–æ—Ç–∞`, 'success');
        }
        
        return { ...quest, current: Math.min(newCurrent, quest.target), completed };
      }
      return quest;
    }));
  }, []);

  // –†–∞–±–æ—Ç–∞
  const performWork = (job) => {
    const now = Date.now();
    const lastTime = lastWorkTime[job.id] || 0;
    
    if (now - lastTime < job.time) {
      const remaining = Math.ceil((job.time - (now - lastTime)) / 1000);
      addNotification(`‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${remaining} —Å–µ–∫`, 'warning');
      return;
    }

    if (player.energy < job.energy) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏', 'error');
      return;
    }

    if (job.requiredLevel && player.level < job.requiredLevel) {
      addNotification(`‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è ${job.requiredLevel} —É—Ä–æ–≤–µ–Ω—å`, 'error');
      return;
    }

    const bonus = Math.floor(job.income * (player.strength / 100));
    const totalIncome = job.income + bonus;

    setPlayer(prev => {
      const newExp = prev.exp + job.exp;
      const newLevel = newExp >= prev.expToNext ? prev.level + 1 : prev.level;
      const newExpToNext = newLevel > prev.level ? prev.expToNext * 1.5 : prev.expToNext;
      
      const newPlayer = {
        ...prev,
        gold: prev.gold + totalIncome,
        energy: prev.energy - job.energy,
        exp: newLevel > prev.level ? newExp - prev.expToNext : newExp,
        level: newLevel,
        expToNext: newExpToNext,
        totalClicks: prev.totalClicks + 1,
        totalEarned: prev.totalEarned + totalIncome,
        maxHealth: newLevel > prev.level ? prev.maxHealth + 10 : prev.maxHealth,
        maxEnergy: newLevel > prev.level ? prev.maxEnergy + 5 : prev.maxEnergy,
        strength: newLevel > prev.level ? prev.strength + 1 : prev.strength,
        intelligence: newLevel > prev.level ? prev.intelligence + 1 : prev.intelligence
      };

      if (newLevel > prev.level) {
        addNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –¢–µ–ø–µ—Ä—å ${newLevel} —É—Ä–æ–≤–µ–Ω—å`, 'success');
      }

      checkAchievements(newPlayer);
      return newPlayer;
    });

    setLastWorkTime(prev => ({ ...prev, [job.id]: now }));
    updateQuest('work');
    updateQuest('earn', totalIncome);
    updateQuest('exp', job.exp);
    
    addClickAnimation(
      Math.random() * 200 + 100,
      Math.random() * 100 + 100,
      `+${totalIncome} üí∞`
    );
    addNotification(`${job.icon} +${totalIncome} –∑–æ–ª–æ—Ç–∞`, 'success');
  };

  // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  const buyItem = (item) => {
    if (player.gold < item.price) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞', 'error');
      return;
    }

    if (item.requiredLevel && player.level < item.requiredLevel) {
      addNotification(`‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è ${item.requiredLevel} —É—Ä–æ–≤–µ–Ω—å`, 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold - item.price }));
    setInventory(prev => [...prev, { ...item, id: Date.now() }]);
    updateQuest('buy');
    addNotification(`‚úÖ –ö—É–ø–ª–µ–Ω–æ: ${item.name}`, 'success');
  };

  // –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  const equipItem = (item) => {
    if (item.type === 'consumable') {
      useConsumable(item);
      return;
    }

    const oldItem = equippedItems[item.type];
    
    setEquippedItems(prev => ({ ...prev, [item.type]: item }));
    setInventory(prev => {
      const filtered = prev.filter(i => i.id !== item.id);
      return oldItem ? [...filtered, oldItem] : filtered;
    });

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã
    setPlayer(prev => {
      let newStats = { ...prev };
      
      // –£–±–∏—Ä–∞–µ–º –±–æ–Ω—É—Å—ã —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      if (oldItem) {
        if (oldItem.strength) newStats.strength -= oldItem.strength;
        if (oldItem.intelligence) newStats.intelligence -= oldItem.intelligence;
        if (oldItem.luck) newStats.luck -= oldItem.luck;
        if (oldItem.maxHealth) newStats.maxHealth -= oldItem.maxHealth;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      if (item.strength) newStats.strength += item.strength;
      if (item.intelligence) newStats.intelligence += item.intelligence;
      if (item.luck) newStats.luck += item.luck;
      if (item.maxHealth) newStats.maxHealth += item.maxHealth;
      
      return newStats;
    });

    addNotification(`‚úÖ –≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ: ${item.name}`, 'success');
  };

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∞
  const useConsumable = (item) => {
    setPlayer(prev => {
      let newStats = { ...prev };
      switch (item.effect) {
        case 'health':
          newStats.health = Math.min(prev.health + item.value, prev.maxHealth);
          break;
        case 'energy':
          newStats.energy = Math.min(prev.energy + item.value, prev.maxEnergy);
          if (newStats.energy === newStats.maxEnergy) updateQuest('energy');
          break;
        case 'exp':
          newStats.exp += item.value;
          break;
        default:
          break;
      }
      return newStats;
    });

    setInventory(prev => prev.filter(i => i.id !== item.id));
    addNotification(`‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${item.name}`, 'success');
  };

  // –°–Ω—è—Ç–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
  const unequipItem = (type) => {
    const item = equippedItems[type];
    if (!item) return;

    setEquippedItems(prev => ({ ...prev, [type]: null }));
    setInventory(prev => [...prev, item]);

    // –£–±–∏—Ä–∞–µ–º –±–æ–Ω—É—Å—ã
    setPlayer(prev => {
      let newStats = { ...prev };
      if (item.strength) newStats.strength -= item.strength;
      if (item.intelligence) newStats.intelligence -= item.intelligence;
      if (item.luck) newStats.luck -= item.luck;
      if (item.maxHealth) newStats.maxHealth -= item.maxHealth;
      return newStats;
    });

    addNotification(`‚úÖ –°–Ω—è—Ç–æ: ${item.name}`, 'success');
  };

  // –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  const depositToBank = () => {
    const amount = parseInt(bankAccount.depositAmount);
    if (isNaN(amount) || amount <= 0) {
      addNotification('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞', 'error');
      return;
    }
    if (player.gold < amount) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞', 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold - amount }));
    setBankAccount(prev => ({ ...prev, balance: prev.balance + amount, depositAmount: '' }));
    addNotification(`‚úÖ –í–Ω–µ—Å–µ–Ω–æ ${amount} –∑–æ–ª–æ—Ç–∞ –≤ –±–∞–Ω–∫`, 'success');
  };

  const withdrawFromBank = () => {
    const amount = parseInt(bankAccount.withdrawAmount);
    if (isNaN(amount) || amount <= 0) {
      addNotification('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞', 'error');
      return;
    }
    if (bankAccount.balance < amount) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –±–∞–Ω–∫–µ', 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold + amount }));
    setBankAccount(prev => ({ ...prev, balance: prev.balance - amount, withdrawAmount: '' }));
    addNotification(`‚úÖ –°–Ω—è—Ç–æ ${amount} –∑–æ–ª–æ—Ç–∞ –∏–∑ –±–∞–Ω–∫–∞`, 'success');
  };

  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
  useEffect(() => {
    const interval = setInterval(() => {
      setPlayer(prev => {
        if (prev.energy < prev.maxEnergy) {
          const newEnergy = Math.min(prev.energy + 1, prev.maxEnergy);
          if (newEnergy === prev.maxEnergy) updateQuest('energy');
          return { ...prev, energy: newEnergy };
        }
        return prev;
      });
    }, 5000);

    return () => clearInterval(interval);
  }, [updateQuest]);

  // –†–µ–Ω–¥–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  const renderProfile = () => (
    <div className="space-y-4">
      <div className="bg-gray-800 rounded-lg p-6 border-2 border-red-900">
        <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
          <div className="flex items-center justify-between mb-2">
            <TrendingUp className="w-6 h-6 text-green-500" />
            <span className="text-gray-400 text-sm">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</span>
          </div>
          <p className="text-2xl font-bold text-green-400">{player.totalEarned}</p>
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h3 className="text-lg font-bold text-red-400 mb-3">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
        <div className="grid grid-cols-3 gap-3">
          <div className="text-center">
            <Sword className="w-6 h-6 text-red-500 mx-auto mb-1" />
            <p className="text-sm text-gray-400">–°–∏–ª–∞</p>
            <p className="text-xl font-bold text-white">{player.strength}</p>
          </div>
          <div className="text-center">
            <Star className="w-6 h-6 text-blue-500 mx-auto mb-1" />
            <p className="text-sm text-gray-400">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</p>
            <p className="text-xl font-bold text-white">{player.intelligence}</p>
          </div>
          <div className="text-center">
            <Gift className="w-6 h-6 text-purple-500 mx-auto mb-1" />
            <p className="text-sm text-gray-400">–£–¥–∞—á–∞</p>
            <p className="text-xl font-bold text-white">{player.luck}</p>
          </div>
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h3 className="text-lg font-bold text-red-400 mb-3">–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h3>
        <div className="space-y-2">
          {['weapon', 'armor', 'accessory'].map(slot => (
            <div key={slot} className="flex items-center justify-between bg-gray-700 p-3 rounded">
              <div className="flex items-center space-x-3">
                {slot === 'weapon' && <Sword className="w-5 h-5 text-red-400" />}
                {slot === 'armor' && <Shield className="w-5 h-5 text-blue-400" />}
                {slot === 'accessory' && <Star className="w-5 h-5 text-purple-400" />}
                <div>
                  <p className="text-sm text-gray-400 capitalize">
                    {slot === 'weapon' ? '–û—Ä—É–∂–∏–µ' : slot === 'armor' ? '–ë—Ä–æ–Ω—è' : '–ê–∫—Å–µ—Å—Å—É–∞—Ä'}
                  </p>
                  {equippedItems[slot] ? (
                    <p className="text-white font-semibold">{equippedItems[slot].icon} {equippedItems[slot].name}</p>
                  ) : (
                    <p className="text-gray-500 italic">–ü—É—Å—Ç–æ</p>
                  )}
                </div>
              </div>
              {equippedItems[slot] && (
                <button
                  onClick={() => unequipItem(slot)}
                  className="px-3 py-1 bg-red-700 hover:bg-red-600 rounded text-white text-sm"
                >
                  –°–Ω—è—Ç—å
                </button>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const renderWork = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üíº –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h2>
        <p className="text-gray-400 text-sm">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ä–∞–±–æ—Ç—ã, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –∑–æ–ª–æ—Ç–æ –∏ –æ–ø—ã—Ç</p>
      </div>

      {jobs.map(job => {
        const isLocked = job.requiredLevel && player.level < job.requiredLevel;
        const lastTime = lastWorkTime[job.id] || 0;
        const now = Date.now();
        const canWork = now - lastTime >= job.time;
        const remaining = canWork ? 0 : Math.ceil((job.time - (now - lastTime)) / 1000);

        return (
          <div key={job.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${isLocked ? 'border-gray-700 opacity-50' : 'border-red-900'}`}>
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center space-x-3">
                <div className="text-4xl">{job.icon}</div>
                <div>
                  <h3 className="text-lg font-bold text-white">{job.name}</h3>
                  <div className="flex items-center space-x-2 text-sm">
                    <span className="text-yellow-400">+{job.income} üí∞</span>
                    <span className="text-purple-400">+{job.exp} ‚≠ê</span>
                    <span className="text-red-400">-{job.energy} ‚ö°</span>
                  </div>
                </div>
              </div>
              {isLocked && <Lock className="w-6 h-6 text-gray-500" />}
            </div>

            {isLocked ? (
              <div className="bg-gray-700 text-center py-2 rounded text-gray-400">
                –¢—Ä–µ–±—É–µ—Ç—Å—è {job.requiredLevel} —É—Ä–æ–≤–µ–Ω—å
              </div>
            ) : (
              <button
                onClick={() => performWork(job)}
                disabled={!canWork || player.energy < job.energy}
                className={`w-full py-2 rounded font-semibold transition-all ${
                  canWork && player.energy >= job.energy
                    ? 'bg-red-600 hover:bg-red-700 text-white'
                    : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                }`}
              >
                {!canWork ? `–û–∂–∏–¥–∞–Ω–∏–µ ${remaining}—Å` : player.energy < job.energy ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏' : '–†–∞–±–æ—Ç–∞—Ç—å'}
              </button>
            )}
          </div>
        );
      })}
    </div>
  );

  const renderInventory = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
        <p className="text-gray-400 text-sm">–ü—Ä–µ–¥–º–µ—Ç–æ–≤: {inventory.length}</p>
      </div>

      {inventory.length === 0 ? (
        <div className="bg-gray-800 rounded-lg p-8 text-center border border-red-900">
          <Package className="w-16 h-16 text-gray-600 mx-auto mb-3" />
          <p className="text-gray-400">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>
          <p className="text-gray-500 text-sm">–ö—É–ø–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ</p>
        </div>
      ) : (
        <div className="grid grid-cols-1 gap-3">
          {inventory.map(item => (
            <div key={item.id} className="bg-gray-800 rounded-lg p-4 border border-red-900">
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center space-x-3">
                  <div className="text-3xl">{item.icon}</div>
                  <div>
                    <h3 className="font-bold text-white">{item.name}</h3>
                    <p className="text-sm text-gray-400 capitalize">{
                      item.type === 'weapon' ? '–û—Ä—É–∂–∏–µ' :
                      item.type === 'armor' ? '–ë—Ä–æ–Ω—è' :
                      item.type === 'accessory' ? '–ê–∫—Å–µ—Å—Å—É–∞—Ä' : '–†–∞—Å—Ö–æ–¥–Ω–∏–∫'
                    }</p>
                  </div>
                </div>
                <button
                  onClick={() => equipItem(item)}
                  className="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white font-semibold"
                >
                  {item.type === 'consumable' ? '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å' : '–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å'}
                </button>
              </div>
              <div className="flex flex-wrap gap-2 text-sm">
                {item.strength && <span className="text-red-400">+{item.strength} üí™ –°–∏–ª–∞</span>}
                {item.intelligence && <span className="text-blue-400">+{item.intelligence} üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</span>}
                {item.luck && <span className="text-purple-400">+{item.luck} üçÄ –£–¥–∞—á–∞</span>}
                {item.maxHealth && <span className="text-green-400">+{item.maxHealth} ‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</span>}
                {item.value && <span className="text-yellow-400">+{item.value} {item.effect === 'health' ? '‚ù§Ô∏è' : item.effect === 'energy' ? '‚ö°' : '‚≠ê'}</span>}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );

  const renderMarket = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üè™ –†—ã–Ω–æ–∫</h2>
        <div className="flex items-center justify-between">
          <p className="text-gray-400 text-sm">–ü–æ–∫—É–ø–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</p>
          <div className="flex items-center space-x-2">
            <Coins className="w-5 h-5 text-yellow-500" />
            <span className="text-yellow-400 font-bold">{player.gold}</span>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 gap-3">
        {marketItems.map(item => {
          const isLocked = item.requiredLevel && player.level < item.requiredLevel;
          const canAfford = player.gold >= item.price;

          return (
            <div key={item.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${isLocked ? 'border-gray-700 opacity-50' : canAfford ? 'border-red-900' : 'border-gray-700'}`}>
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center space-x-3">
                  <div className="text-3xl">{item.icon}</div>
                  <div>
                    <h3 className="font-bold text-white">{item.name}</h3>
                    <p className="text-sm text-gray-400 capitalize">{
                      item.type === 'weapon' ? '–û—Ä—É–∂–∏–µ' :
                      item.type === 'armor' ? '–ë—Ä–æ–Ω—è' :
                      item.type === 'accessory' ? '–ê–∫—Å–µ—Å—Å—É–∞—Ä' : '–†–∞—Å—Ö–æ–¥–Ω–∏–∫'
                    }</p>
                  </div>
                </div>
                <div className="text-right">
                  <div className="flex items-center space-x-1">
                    <Coins className="w-5 h-5 text-yellow-500" />
                    <span className={`font-bold ${canAfford ? 'text-yellow-400' : 'text-red-500'}`}>{item.price}</span>
                  </div>
                  {isLocked && (
                    <div className="flex items-center space-x-1 mt-1">
                      <Lock className="w-4 h-4 text-gray-500" />
                      <span className="text-xs text-gray-500">–£—Ä.{item.requiredLevel}</span>
                    </div>
                  )}
                </div>
              </div>

              <div className="flex flex-wrap gap-2 text-sm mb-3">
                {item.strength && <span className="text-red-400">+{item.strength} üí™</span>}
                {item.intelligence && <span className="text-blue-400">+{item.intelligence} üß†</span>}
                {item.luck && <span className="text-purple-400">+{item.luck} üçÄ</span>}
                {item.maxHealth && <span className="text-green-400">+{item.maxHealth} ‚ù§Ô∏è</span>}
                {item.value && <span className="text-yellow-400">+{item.value} {item.effect === 'health' ? '‚ù§Ô∏è' : item.effect === 'energy' ? '‚ö°' : '‚≠ê'}</span>}
              </div>

              <button
                onClick={() => buyItem(item)}
                disabled={!canAfford || isLocked}
                className={`w-full py-2 rounded font-semibold transition-all ${
                  canAfford && !isLocked
                    ? 'bg-red-600 hover:bg-red-700 text-white'
                    : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                }`}
              >
                {isLocked ? `–¢—Ä–µ–±—É–µ—Ç—Å—è ${item.requiredLevel} —É—Ä.` : !canAfford ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞' : '–ö—É–ø–∏—Ç—å'}
              </button>
            </div>
          );
        })}
      </div>
    </div>
  );

  const renderBank = () => (
    <div className="space-y-4">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üè¶ –ë–∞–Ω–∫</h2>
        <p className="text-gray-400 text-sm">–•—Ä–∞–Ω–∏—Ç–µ –∑–æ–ª–æ—Ç–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</p>
      </div>

      <div className="bg-gray-800 rounded-lg p-6 border-2 border-red-900">
        <div className="text-center mb-6">
          <DollarSign className="w-16 h-16 text-yellow-500 mx-auto mb-3" />
          <p className="text-gray-400 mb-2">–ë–∞–ª–∞–Ω—Å –≤ –±–∞–Ω–∫–µ</p>
          <p className="text-4xl font-bold text-yellow-400">{bankAccount.balance}</p>
        </div>

        <div className="space-y-4">
          <div>
            <label className="block text-gray-400 mb-2 text-sm">–í–Ω–µ—Å—Ç–∏ –≤ –±–∞–Ω–∫</label>
            <div className="flex space-x-2">
              <input
                type="number"
                value={bankAccount.depositAmount}
                onChange={(e) => setBankAccount(prev => ({ ...prev, depositAmount: e.target.value }))}
                placeholder="–°—É–º–º–∞"
                className="flex-1 px-4 py-2 bg-gray-700 border border-red-900 rounded text-white"
              />
              <button
                onClick={depositToBank}
                className="px-6 py-2 bg-green-600 hover:bg-green-700 rounded text-white font-semibold"
              >
                –í–Ω–µ—Å—Ç–∏
              </button>
            </div>
            <p className="text-xs text-gray-500 mt-1">–î–æ—Å—Ç—É–ø–Ω–æ: {player.gold} –∑–æ–ª–æ—Ç–∞</p>
          </div>

          <div>
            <label className="block text-gray-400 mb-2 text-sm">–°–Ω—è—Ç—å –∏–∑ –±–∞–Ω–∫–∞</label>
            <div className="flex space-x-2">
              <input
                type="number"
                value={bankAccount.withdrawAmount}
                onChange={(e) => setBankAccount(prev => ({ ...prev, withdrawAmount: e.target.value }))}
                placeholder="–°—É–º–º–∞"
                className="flex-1 px-4 py-2 bg-gray-700 border border-red-900 rounded text-white"
              />
              <button
                onClick={withdrawFromBank}
                className="px-6 py-2 bg-red-600 hover:bg-red-700 rounded text-white font-semibold"
              >
                –°–Ω—è—Ç—å
              </button>
            </div>
            <p className="text-xs text-gray-500 mt-1">–í –±–∞–Ω–∫–µ: {bankAccount.balance} –∑–æ–ª–æ—Ç–∞</p>
          </div>
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h3 className="font-bold text-red-400 mb-2">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <ul className="text-sm text-gray-400 space-y-1">
          <li>‚Ä¢ –•—Ä–∞–Ω–∏—Ç–µ –∑–æ–ª–æ—Ç–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</li>
          <li>‚Ä¢ –ë–∞–Ω–∫ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä—å</li>
          <li>‚Ä¢ –°–Ω–∏–º–∞–π—Ç–µ –∫–æ–≥–¥–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è</li>
        </ul>
      </div>
    </div>
  );

  const renderQuests = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üìã –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã</h2>
        <p className="text-gray-400 text-sm">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–≤–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥</p>
      </div>

      {dailyQuests.map(quest => (
        <div key={quest.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${quest.completed ? 'border-green-600' : 'border-red-900'}`}>
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center space-x-3">
              <div className="text-3xl">{quest.icon}</div>
              <div>
                <h3 className="font-bold text-white">{quest.name}</h3>
                <p className="text-sm text-gray-400">–ù–∞–≥—Ä–∞–¥–∞: {quest.reward} üí∞ + {quest.exp} ‚≠ê</p>
              </div>
            </div>
            {quest.completed && <CheckCircle className="w-6 h-6 text-green-500" />}
          </div>

          <div className="mb-2">
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
              <span className="text-red-400">{quest.current}/{quest.target}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div 
                className={`h-2 rounded-full transition-all ${quest.completed ? 'bg-green-500' : 'bg-red-500'}`}
                style={{ width: `${Math.min((quest.current / quest.target) * 100, 100)}%` }}
              ></div>
            </div>
          </div>
        </div>
      ))}

      <button
        onClick={() => setDailyQuests(generateDailyQuests())}
        className="w-full py-3 bg-red-600 hover:bg-red-700 rounded text-white font-semibold"
      >
        üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–≤–µ—Å—Ç—ã
      </button>
    </div>
  );

  const renderAchievements = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
        <p className="text-gray-400 text-sm">–ü–æ–ª—É—á–µ–Ω–æ: {achievements.length}/{achievementsList.length}</p>
      </div>

      {achievementsList.map(achievement => {
        const unlocked = achievements.includes(achievement.id);
        let progress = 0;

        switch (achievement.type) {
          case 'clicks':
            progress = player.totalClicks;
            break;
          case 'earned':
            progress = player.totalEarned;
            break;
          case 'level':
            progress = player.level;
            break;
          case 'quests':
            progress = dailyQuests.filter(q => q.completed).length;
            break;
          default:
            break;
        }

        return (
          <div key={achievement.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${unlocked ? 'border-yellow-600' : 'border-gray-700'} ${!unlocked && 'opacity-60'}`}>
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center space-x-3">
                <div className="text-3xl">{achievement.icon}</div>
                <div>
                  <h3 className="font-bold text-white flex items-center space-x-2">
                    <span>{achievement.name}</span>
                    {unlocked && <Award className="w-5 h-5 text-yellow-500" />}
                  </h3>
                  <p className="text-sm text-gray-400">{achievement.desc}</p>
                </div>
              </div>
            </div>

            <div className="mb-2">
              <div className="flex justify-between text-sm mb-1">
                <span className="text-gray-400">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                <span className={unlocked ? 'text-yellow-400' : 'text-red-400'}>
                  {Math.min(progress, achievement.requirement)}/{achievement.requirement}
                </span>
              </div>
              <div className="w-full bg-gray-700 rounded-full h-2">
                <div 
                  className={`h-2 rounded-full transition-all ${unlocked ? 'bg-yellow-500' : 'bg-red-500'}`}
                  style={{ width: `${Math.min((progress / achievement.requirement) * 100, 100)}%` }}
                ></div>
              </div>
            </div>

            {unlocked && (
              <div className="bg-yellow-900 bg-opacity-30 rounded p-2 text-center">
                <span className="text-yellow-400 font-semibold">–ù–∞–≥—Ä–∞–¥–∞: {achievement.reward} üí∞</span>
              </div>
            )}
          </div>
        );
      })}
    </div>
  );

  const renderLeaderboard = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üë• –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
        <p className="text-gray-400 text-sm">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º—É –∑–æ–ª–æ—Ç—É</p>
      </div>

      {leaderboard.length === 0 ? (
        <div className="bg-gray-800 rounded-lg p-8 text-center border border-red-900">
          <Users className="w-16 h-16 text-gray-600 mx-auto mb-3" />
          <p className="text-gray-400">–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç</p>
          <p className="text-gray-500 text-sm">–ù–∞—á–Ω–∏—Ç–µ –∏–≥—Ä–∞—Ç—å, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ —Ç–æ–ø!</p>
        </div>
      ) : (
        <div className="space-y-2">
          {leaderboard.map((p, index) => (
            <div 
              key={p.telegramId} 
              className={`bg-gray-800 rounded-lg p-4 border-2 ${
                p.telegramId === player.telegramId ? 'border-red-500' : 'border-red-900'
              }`}
            >
              <div className="flex items-center space-x-3">
                <div className="text-2xl font-bold w-8 text-center">
                  {index === 0 && 'ü•á'}
                  {index === 1 && 'ü•à'}
                  {index === 2 && 'ü•â'}
                  {index > 2 && <span className="text-gray-400">{index + 1}</span>}
                </div>

                {p.photoUrl ? (
                  <img src={p.photoUrl} alt="Avatar" className="w-12 h-12 rounded-full border-2 border-red-500" />
                ) : (
                  <div className="w-12 h-12 rounded-full bg-red-900 flex items-center justify-center border-2 border-red-500">
                    <Users className="w-6 h-6 text-red-300" />
                  </div>
                )}

                <div className="flex-1">
                  <h3 className="font-bold text-white">{p.username}</h3>
                  <div className="flex items-center space-x-3 text-sm">
                    <span className="text-gray-400">–£—Ä. {p.level}</span>
                    <span className="text-yellow-400">{p.totalEarned} üí∞</span>
                  </div>
                </div>

                {p.telegramId === player.telegramId && (
                  <Medal className="w-6 h-6 text-red-500" />
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-900 to-black text-white pb-20">
      {/* –ê–Ω–∏–º–∞—Ü–∏–∏ –∫–ª–∏–∫–æ–≤ */}
      {clickAnimations.map(anim => (
        <div
          key={anim.id}
          className="fixed text-2xl font-bold text-yellow-400 pointer-events-none animate-bounce"
          style={{
            left: anim.x,
            top: anim.y,
            animation: 'float-up 1s ease-out forwards'
          }}
        >
          {anim.text}
        </div>
      ))}

      {/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */}
      <div className="fixed top-4 right-4 z-50 space-y-2">
        {notifications.map(notif => (
          <div
            key={notif.id}
            className={`px-4 py-3 rounded-lg shadow-lg max-w-sm animate-slide-in ${
              notif.type === 'success' ? 'bg-green-600' :
              notif.type === 'error' ? 'bg-red-600' :
              notif.type === 'warning' ? 'bg-yellow-600' :
              notif.type === 'achievement' ? 'bg-purple-600' :
              'bg-blue-600'
            }`}
          >
            <p className="text-white font-semibold">{notif.message}</p>
          </div>
        ))}
      </div>

      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
      <div className="bg-gradient-to-r from-red-900 to-gray-900 p-4 shadow-lg border-b-2 border-red-700">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold text-red-400">‚öîÔ∏è –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è RPG</h1>
            <p className="text-sm text-gray-400">–£—Ä–æ–≤–µ–Ω—å {player.level} ‚Ä¢ {player.gold} üí∞</p>
          </div>
          <div className="flex items-center space-x-2">
            <div className="text-right">
              <p className="text-xs text-gray-400">–≠–Ω–µ—Ä–≥–∏—è</p>
              <p className="text-sm font-bold text-yellow-400">{player.energy}/{player.maxEnergy}</p>
            </div>
          </div>
        </div>
      </div>

      {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
      <div className="p-4 max-w-2xl mx-auto">
        {activeTab === 'profile' && renderProfile()}
        {activeTab === 'work' && renderWork()}
        {activeTab === 'inventory' && renderInventory()}
        {activeTab === 'market' && renderMarket()}
        {activeTab === 'bank' && renderBank()}
        {activeTab === 'quests' && renderQuests()}
        {activeTab === 'achievements' && renderAchievements()}
        {activeTab === 'leaderboard' && renderLeaderboard()}
      </div>

      {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
      <div className="fixed bottom-0 left-0 right-0 bg-gray-900 border-t-2 border-red-900 shadow-lg">
        <div className="flex justify-around py-2 max-w-2xl mx-auto">
          {[
            { id: 'profile', icon: Users, label: '–ü—Ä–æ—Ñ–∏–ª—å' },
            { id: 'work', icon: Briefcase, label: '–†–∞–±–æ—Ç–∞' },
            { id: 'inventory', icon: Package, label: '–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å' },
            { id: 'market', icon: ShoppingCart, label: '–†—ã–Ω–æ–∫' },
            { id: 'bank', icon: DollarSign, label: '–ë–∞–Ω–∫' },
            { id: 'quests', icon: Target, label: '–ö–≤–µ—Å—Ç—ã' },
            { id: 'achievements', icon: Trophy, label: '–ù–∞–≥—Ä–∞–¥—ã' },
            { id: 'leaderboard', icon: Medal, label: '–†–µ–π—Ç–∏–Ω–≥' }
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`flex flex-col items-center space-y-1 px-2 py-1 rounded transition-all ${
                activeTab === tab.id ? 'text-red-400' :="flex items-center space-x-4 mb-4">
          {player.photoUrl ? (
            <img src={player.photoUrl} alt="Avatar" className="w-20 h-20 rounded-full border-2 border-red-500" />
          ) : (
            <div className="w-20 h-20 rounded-full bg-red-900 flex items-center justify-center border-2 border-red-500">
              <Users className="w-10 h-10 text-red-300" />
            </div>
          )}
          <div className="flex-1">
            <h2 className="text-2xl font-bold text-red-400">{player.firstName}</h2>
            <p className="text-gray-400">@{player.username}</p>
            <div className="flex items-center space-x-2 mt-2">
              <Crown className="w-5 h-5 text-yellow-500" />
              <span className="text-white font-semibold">–£—Ä–æ–≤–µ–Ω—å {player.level}</span>
            </div>
          </div>
        </div>

        <div className="space-y-3">
          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400">–û–ø—ã—Ç</span>
              <span className="text-red-400">{Math.floor(player.exp)}/{Math.floor(player.expToNext)}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-red-500 h-2 rounded-full transition-all" style={{ width: `${(player.exp / player.expToNext) * 100}%` }}></div>
            </div>
          </div>

          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400 flex items-center"><Heart className="w-4 h-4 mr-1" />–ó–¥–æ—Ä–æ–≤—å–µ</span>
              <span className="text-red-400">{player.health}/{player.maxHealth}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-red-600 h-2 rounded-full transition-all" style={{ width: `${(player.health / player.maxHealth) * 100}%` }}></div>
            </div>
          </div>

          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400 flex items-center"><Zap className="w-4 h-4 mr-1" />–≠–Ω–µ—Ä–≥–∏—è</span>
              <span className="text-red-400">{player.energy}/{player.maxEnergy}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-yellow-500 h-2 rounded-full transition-all" style={{ width: `${(player.energy / player.maxEnergy) * 100}%` }}></div>
            </div>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
          <div className="flex items-center justify-between mb-2">
            <Coins className="w-6 h-6 text-yellow-500" />
            <span className="text-gray-400 text-sm">–ó–æ–ª–æ—Ç–æ</span>
          </div>
          <p className="text-2xl font-bold text-yellow-400">{player.gold}</p>
        </div>

        <div className
            import React, { useState, useEffect, useCallback } from 'react';
import { Users, Briefcase, Package, ShoppingCart, DollarSign, Target, Trophy, Award, Sword, Shield, Hammer, Axe, Crown, Coins, Heart, Zap, Star, TrendingUp, Gift, Lock, CheckCircle, Medal } from 'lucide-react';

const MedievalRPG = () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
  useEffect(() => {
    if (window.Telegram?.WebApp) {
      window.Telegram.WebApp.ready();
      window.Telegram.WebApp.expand();
    }
  }, []);

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
  const getTelegramUser = () => {
    if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
      const user = window.Telegram.WebApp.initDataUnsafe.user;
      return {
        id: user.id,
        username: user.username || '–ü—É—Ç–Ω–∏–∫',
        firstName: user.first_name || '–ü—É—Ç–Ω–∏–∫',
        photoUrl: user.photo_url || null
      };
    }
    return {
      id: Date.now(),
      username: '–ü—É—Ç–Ω–∏–∫',
      firstName: '–ü—É—Ç–Ω–∏–∫',
      photoUrl: null
    };
  };

  const telegramUser = getTelegramUser();

  // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  const initialPlayerState = {
    username: telegramUser.username,
    firstName: telegramUser.firstName,
    photoUrl: telegramUser.photoUrl,
    telegramId: telegramUser.id,
    level: 1,
    exp: 0,
    expToNext: 100,
    gold: 100,
    health: 100,
    maxHealth: 100,
    energy: 100,
    maxEnergy: 100,
    strength: 5,
    intelligence: 5,
    luck: 5,
    totalClicks: 0,
    totalEarned: 0
  };

  // –°–æ—Å—Ç–æ—è–Ω–∏—è
  const [player, setPlayer] = useState(initialPlayerState);
  const [activeTab, setActiveTab] = useState('work');
  const [inventory, setInventory] = useState([]);
  const [equippedItems, setEquippedItems] = useState({
    weapon: null,
    armor: null,
    accessory: null
  });
  const [dailyQuests, setDailyQuests] = useState([]);
  const [achievements, setAchievements] = useState([]);
  const [leaderboard, setLeaderboard] = useState([]);
  const [bankAccount, setBankAccount] = useState({
    balance: 0,
    depositAmount: '',
    withdrawAmount: ''
  });
  const [notifications, setNotifications] = useState([]);
  const [lastWorkTime, setLastWorkTime] = useState({});
  const [clickAnimations, setClickAnimations] = useState([]);

  // –†–∞–±–æ—Ç—ã
  const jobs = [
    { id: 'farmer', name: '–§–µ—Ä–º–µ—Ä', icon: 'üåæ', income: 10, energy: 5, time: 3000, exp: 5 },
    { id: 'miner', name: '–®–∞—Ö—Ç–µ—Ä', icon: '‚õèÔ∏è', income: 15, energy: 8, time: 4000, exp: 8 },
    { id: 'blacksmith', name: '–ö—É–∑–Ω–µ—Ü', icon: '‚öíÔ∏è', income: 25, energy: 12, time: 5000, exp: 12, requiredLevel: 3 },
    { id: 'merchant', name: '–¢–æ—Ä–≥–æ–≤–µ—Ü', icon: 'üí∞', income: 35, energy: 10, time: 6000, exp: 15, requiredLevel: 5 },
    { id: 'hunter', name: '–û—Ö–æ—Ç–Ω–∏–∫', icon: 'üèπ', income: 45, energy: 15, time: 7000, exp: 20, requiredLevel: 8 },
    { id: 'knight', name: '–†—ã—Ü–∞—Ä—å', icon: '‚öîÔ∏è', income: 60, energy: 20, time: 8000, exp: 30, requiredLevel: 12 },
    { id: 'wizard', name: '–ú–∞–≥', icon: 'üîÆ', income: 80, energy: 25, time: 9000, exp: 40, requiredLevel: 15 },
    { id: 'lord', name: '–õ–æ—Ä–¥', icon: 'üëë', income: 120, energy: 30, time: 10000, exp: 60, requiredLevel: 20 }
  ];

  // –ü—Ä–µ–¥–º–µ—Ç—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ
  const marketItems = [
    { id: 'sword1', name: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–µ—á', type: 'weapon', price: 50, strength: 2, icon: 'üó°Ô∏è' },
    { id: 'sword2', name: '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á', type: 'weapon', price: 200, strength: 5, icon: '‚öîÔ∏è', requiredLevel: 5 },
    { id: 'sword3', name: '–°—Ç–∞–ª—å–Ω–æ–π –º–µ—á', type: 'weapon', price: 500, strength: 10, icon: 'üó°Ô∏è', requiredLevel: 10 },
    { id: 'sword4', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—á', type: 'weapon', price: 2000, strength: 25, icon: '‚öîÔ∏è', requiredLevel: 15 },
    { id: 'armor1', name: '–ö–æ–∂–∞–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', price: 80, maxHealth: 20, icon: 'üõ°Ô∏è' },
    { id: 'armor2', name: '–ö–æ–ª—å—á—É–≥–∞', type: 'armor', price: 300, maxHealth: 50, icon: 'üõ°Ô∏è', requiredLevel: 5 },
    { id: 'armor3', name: '–õ–∞—Ç—ã', type: 'armor', price: 800, maxHealth: 100, icon: 'üõ°Ô∏è', requiredLevel: 10 },
    { id: 'armor4', name: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ –ª–∞—Ç—ã', type: 'armor', price: 3000, maxHealth: 200, icon: 'üõ°Ô∏è', requiredLevel: 15 },
    { id: 'ring1', name: '–ö–æ–ª—å—Ü–æ —É–¥–∞—á–∏', type: 'accessory', price: 150, luck: 3, icon: 'üíç' },
    { id: 'ring2', name: '–ê–º—É–ª–µ—Ç —Å–∏–ª—ã', type: 'accessory', price: 400, strength: 5, icon: 'üìø', requiredLevel: 8 },
    { id: 'ring3', name: '–ö–æ—Ä–æ–Ω–∞ –º—É–¥—Ä–æ—Å—Ç–∏', type: 'accessory', price: 1000, intelligence: 10, icon: 'üëë', requiredLevel: 12 },
    { id: 'potion1', name: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', type: 'consumable', price: 30, effect: 'health', value: 50, icon: 'üß™' },
    { id: 'potion2', name: '–ó–µ–ª—å–µ —ç–Ω–µ—Ä–≥–∏–∏', type: 'consumable', effect: 'energy', price: 25, value: 50, icon: '‚ö°' },
    { id: 'potion3', name: '–ó–µ–ª—å–µ –æ–ø—ã—Ç–∞', type: 'consumable', price: 100, effect: 'exp', value: 50, icon: '‚ú®', requiredLevel: 5 }
  ];

  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  const achievementsList = [
    { id: 'clicks100', name: '–ù–æ–≤–∏—á–æ–∫', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 100 –∫–ª–∏–∫–æ–≤', icon: 'üëÜ', requirement: 100, type: 'clicks', reward: 50 },
    { id: 'clicks500', name: '–û–ø—ã—Ç–Ω—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 500 –∫–ª–∏–∫–æ–≤', icon: 'üí™', requirement: 500, type: 'clicks', reward: 200 },
    { id: 'clicks1000', name: '–ú–∞—Å—Ç–µ—Ä —Ç—Ä—É–¥–∞', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 1000 –∫–ª–∏–∫–æ–≤', icon: '‚≠ê', requirement: 1000, type: 'clicks', reward: 500 },
    { id: 'gold1000', name: '–ë–æ–≥–∞—á', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 1000 –∑–æ–ª–æ—Ç–∞', icon: 'üí∞', requirement: 1000, type: 'earned', reward: 100 },
    { id: 'gold5000', name: '–ú–∞–≥–Ω–∞—Ç', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 5000 –∑–æ–ª–æ—Ç–∞', icon: 'üíé', requirement: 5000, type: 'earned', reward: 500 },
    { id: 'level5', name: '–í–æ–∏–Ω 5 —É—Ä–æ–≤–Ω—è', desc: '–î–æ—Å—Ç–∏—á—å 5 —É—Ä–æ–≤–Ω—è', icon: 'üéñÔ∏è', requirement: 5, type: 'level', reward: 200 },
    { id: 'level10', name: '–í–æ–∏–Ω 10 —É—Ä–æ–≤–Ω—è', desc: '–î–æ—Å—Ç–∏—á—å 10 —É—Ä–æ–≤–Ω—è', icon: 'üèÜ', requirement: 10, type: 'level', reward: 500 },
    { id: 'level20', name: '–õ–µ–≥–µ–Ω–¥–∞', desc: '–î–æ—Å—Ç–∏—á—å 20 —É—Ä–æ–≤–Ω—è', icon: 'üëë', requirement: 20, type: 'level', reward: 2000 },
    { id: 'quest10', name: '–ò—Å–∫–∞—Ç–µ–ª—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 10 –∫–≤–µ—Å—Ç–æ–≤', icon: 'üéØ', requirement: 10, type: 'quests', reward: 300 },
    { id: 'quest50', name: '–ì–µ—Ä–æ–π –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–∞', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 50 –∫–≤–µ—Å—Ç–æ–≤', icon: '‚öîÔ∏è', requirement: 50, type: 'quests', reward: 1000 }
  ];

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤
  const generateDailyQuests = useCallback(() => {
    const quests = [
      { id: 1, name: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 100 –∑–æ–ª–æ—Ç–∞', type: 'earn', target: 100, current: 0, reward: 50, exp: 20, icon: 'üí∞' },
      { id: 2, name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å 20 —Ä–∞–±–æ—Ç', type: 'work', target: 20, current: 0, reward: 80, exp: 30, icon: '‚öíÔ∏è' },
      { id: 3, name: '–ö—É–ø–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –º–∞–≥–∞–∑–∏–Ω–µ', type: 'buy', target: 1, current: 0, reward: 40, exp: 15, icon: 'üõí' },
      { id: 4, name: '–î–æ—Å—Ç–∏—á—å –ø–æ–ª–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏', type: 'energy', target: 1, current: 0, reward: 30, exp: 10, icon: '‚ö°' },
      { id: 5, name: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 50 –æ–ø—ã—Ç–∞', type: 'exp', target: 50, current: 0, reward: 60, exp: 25, icon: '‚≠ê' }
    ];
    
    // –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–≤–µ—Å—Ç–∞
    const shuffled = quests.sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 3);
  }, []);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    const loadGame = async () => {
      try {
        const savedPlayer = await window.storage.get('player');
        const savedInventory = await window.storage.get('inventory');
        const savedEquipped = await window.storage.get('equipped');
        const savedQuests = await window.storage.get('dailyQuests');
        const savedAchievements = await window.storage.get('achievements');
        const savedBank = await window.storage.get('bank');
        const savedLeaderboard = await window.storage.get('leaderboard', true);
        const savedLastWork = await window.storage.get('lastWorkTime');

        if (savedPlayer) {
          const playerData = JSON.parse(savedPlayer.value);
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram
          playerData.username = telegramUser.username;
          playerData.firstName = telegramUser.firstName;
          playerData.photoUrl = telegramUser.photoUrl;
          playerData.telegramId = telegramUser.id;
          setPlayer(playerData);
        }
        if (savedInventory) setInventory(JSON.parse(savedInventory.value));
        if (savedEquipped) setEquippedItems(JSON.parse(savedEquipped.value));
        if (savedQuests) setDailyQuests(JSON.parse(savedQuests.value));
        else setDailyQuests(generateDailyQuests());
        if (savedAchievements) setAchievements(JSON.parse(savedAchievements.value));
        if (savedBank) setBankAccount(JSON.parse(savedBank.value));
        if (savedLeaderboard) setLeaderboard(JSON.parse(savedLeaderboard.value));
        if (savedLastWork) setLastWorkTime(JSON.parse(savedLastWork.value));
      } catch (err) {
        console.log('–ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É');
        setDailyQuests(generateDailyQuests());
      }
    };
    loadGame();
  }, [generateDailyQuests, telegramUser]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    const saveGame = async () => {
      try {
        await window.storage.set('player', JSON.stringify(player));
        await window.storage.set('inventory', JSON.stringify(inventory));
        await window.storage.set('equipped', JSON.stringify(equippedItems));
        await window.storage.set('dailyQuests', JSON.stringify(dailyQuests));
        await window.storage.set('achievements', JSON.stringify(achievements));
        await window.storage.set('bank', JSON.stringify(bankAccount));
        await window.storage.set('lastWorkTime', JSON.stringify(lastWorkTime));
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–æ–±—â–∏–π –¥–æ—Å—Ç—É–ø)
        const newLeaderboard = [...leaderboard];
        const playerIndex = newLeaderboard.findIndex(p => p.telegramId === player.telegramId);
        const playerData = {
          telegramId: player.telegramId,
          username: player.username,
          level: player.level,
          gold: player.gold,
          totalEarned: player.totalEarned,
          photoUrl: player.photoUrl
        };
        
        if (playerIndex >= 0) {
          newLeaderboard[playerIndex] = playerData;
        } else {
          newLeaderboard.push(playerData);
        }
        
        newLeaderboard.sort((a, b) => b.totalEarned - a.totalEarned);
        const top100 = newLeaderboard.slice(0, 100);
        
        await window.storage.set('leaderboard', JSON.stringify(top100), true);
        setLeaderboard(top100);
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', err);
      }
    };
    saveGame();
  }, [player, inventory, equippedItems, dailyQuests, achievements, bankAccount, lastWorkTime]);

  // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  const addNotification = (message, type = 'success') => {
    const id = Date.now();
    setNotifications(prev => [...prev, { id, message, type }]);
    setTimeout(() => {
      setNotifications(prev => prev.filter(n => n.id !== id));
    }, 3000);
  };

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–ª–∏–∫–∞
  const addClickAnimation = (x, y, text) => {
    const id = Date.now();
    setClickAnimations(prev => [...prev, { id, x, y, text }]);
    setTimeout(() => {
      setClickAnimations(prev => prev.filter(a => a.id !== id));
    }, 1000);
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  const checkAchievements = useCallback((newPlayer) => {
    achievementsList.forEach(achievement => {
      if (achievements.includes(achievement.id)) return;

      let unlocked = false;
      switch (achievement.type) {
        case 'clicks':
          unlocked = newPlayer.totalClicks >= achievement.requirement;
          break;
        case 'earned':
          unlocked = newPlayer.totalEarned >= achievement.requirement;
          break;
        case 'level':
          unlocked = newPlayer.level >= achievement.requirement;
          break;
        case 'quests':
          const completedQuests = dailyQuests.filter(q => q.completed).length;
          unlocked = completedQuests >= achievement.requirement;
          break;
        default:
          break;
      }

      if (unlocked) {
        setAchievements(prev => [...prev, achievement.id]);
        setPlayer(p => ({ ...p, gold: p.gold + achievement.reward }));
        addNotification(`üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.name}! +${achievement.reward} –∑–æ–ª–æ—Ç–∞`, 'achievement');
      }
    });
  }, [achievements, dailyQuests]);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤
  const updateQuest = useCallback((type, amount = 1) => {
    setDailyQuests(prev => prev.map(quest => {
      if (quest.type === type && !quest.completed) {
        const newCurrent = quest.current + amount;
        const completed = newCurrent >= quest.target;
        
        if (completed && !quest.completed) {
          setPlayer(p => ({
            ...p,
            gold: p.gold + quest.reward,
            exp: p.exp + quest.exp
          }));
          addNotification(`‚úÖ –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω: ${quest.name}! +${quest.reward} –∑–æ–ª–æ—Ç–∞`, 'success');
        }
        
        return { ...quest, current: Math.min(newCurrent, quest.target), completed };
      }
      return quest;
    }));
  }, []);

  // –†–∞–±–æ—Ç–∞
  const performWork = (job) => {
    const now = Date.now();
    const lastTime = lastWorkTime[job.id] || 0;
    
    if (now - lastTime < job.time) {
      const remaining = Math.ceil((job.time - (now - lastTime)) / 1000);
      addNotification(`‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${remaining} —Å–µ–∫`, 'warning');
      return;
    }

    if (player.energy < job.energy) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏', 'error');
      return;
    }

    if (job.requiredLevel && player.level < job.requiredLevel) {
      addNotification(`‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è ${job.requiredLevel} —É—Ä–æ–≤–µ–Ω—å`, 'error');
      return;
    }

    const bonus = Math.floor(job.income * (player.strength / 100));
    const totalIncome = job.income + bonus;

    setPlayer(prev => {
      const newExp = prev.exp + job.exp;
      const newLevel = newExp >= prev.expToNext ? prev.level + 1 : prev.level;
      const newExpToNext = newLevel > prev.level ? prev.expToNext * 1.5 : prev.expToNext;
      
      const newPlayer = {
        ...prev,
        gold: prev.gold + totalIncome,
        energy: prev.energy - job.energy,
        exp: newLevel > prev.level ? newExp - prev.expToNext : newExp,
        level: newLevel,
        expToNext: newExpToNext,
        totalClicks: prev.totalClicks + 1,
        totalEarned: prev.totalEarned + totalIncome,
        maxHealth: newLevel > prev.level ? prev.maxHealth + 10 : prev.maxHealth,
        maxEnergy: newLevel > prev.level ? prev.maxEnergy + 5 : prev.maxEnergy,
        strength: newLevel > prev.level ? prev.strength + 1 : prev.strength,
        intelligence: newLevel > prev.level ? prev.intelligence + 1 : prev.intelligence
      };

      if (newLevel > prev.level) {
        addNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –¢–µ–ø–µ—Ä—å ${newLevel} —É—Ä–æ–≤–µ–Ω—å`, 'success');
      }

      checkAchievements(newPlayer);
      return newPlayer;
    });

    setLastWorkTime(prev => ({ ...prev, [job.id]: now }));
    updateQuest('work');
    updateQuest('earn', totalIncome);
    updateQuest('exp', job.exp);
    
    addClickAnimation(
      Math.random() * 200 + 100,
      Math.random() * 100 + 100,
      `+${totalIncome} üí∞`
    );
    addNotification(`${job.icon} +${totalIncome} –∑–æ–ª–æ—Ç–∞`, 'success');
  };

  // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  const buyItem = (item) => {
    if (player.gold < item.price) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞', 'error');
      return;
    }

    if (item.requiredLevel && player.level < item.requiredLevel) {
      addNotification(`‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è ${item.requiredLevel} —É—Ä–æ–≤–µ–Ω—å`, 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold - item.price }));
    setInventory(prev => [...prev, { ...item, id: Date.now() }]);
    updateQuest('buy');
    addNotification(`‚úÖ –ö—É–ø–ª–µ–Ω–æ: ${item.name}`, 'success');
  };

  // –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  const equipItem = (item) => {
    if (item.type === 'consumable') {
      useConsumable(item);
      return;
    }

    const oldItem = equippedItems[item.type];
    
    setEquippedItems(prev => ({ ...prev, [item.type]: item }));
    setInventory(prev => {
      const filtered = prev.filter(i => i.id !== item.id);
      return oldItem ? [...filtered, oldItem] : filtered;
    });

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã
    setPlayer(prev => {
      let newStats = { ...prev };
      
      // –£–±–∏—Ä–∞–µ–º –±–æ–Ω—É—Å—ã —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      if (oldItem) {
        if (oldItem.strength) newStats.strength -= oldItem.strength;
        if (oldItem.intelligence) newStats.intelligence -= oldItem.intelligence;
        if (oldItem.luck) newStats.luck -= oldItem.luck;
        if (oldItem.maxHealth) newStats.maxHealth -= oldItem.maxHealth;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      if (item.strength) newStats.strength += item.strength;
      if (item.intelligence) newStats.intelligence += item.intelligence;
      if (item.luck) newStats.luck += item.luck;
      if (item.maxHealth) newStats.maxHealth += item.maxHealth;
      
      return newStats;
    });

    addNotification(`‚úÖ –≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ: ${item.name}`, 'success');
  };

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∞
  const useConsumable = (item) => {
    setPlayer(prev => {
      let newStats = { ...prev };
      switch (item.effect) {
        case 'health':
          newStats.health = Math.min(prev.health + item.value, prev.maxHealth);
          break;
        case 'energy':
          newStats.energy = Math.min(prev.energy + item.value, prev.maxEnergy);
          if (newStats.energy === newStats.maxEnergy) updateQuest('energy');
          break;
        case 'exp':
          newStats.exp += item.value;
          break;
        default:
          break;
      }
      return newStats;
    });

    setInventory(prev => prev.filter(i => i.id !== item.id));
    addNotification(`‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${item.name}`, 'success');
  };

  // –°–Ω—è—Ç–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
  const unequipItem = (type) => {
    const item = equippedItems[type];
    if (!item) return;

    setEquippedItems(prev => ({ ...prev, [type]: null }));
    setInventory(prev => [...prev, item]);

    // –£–±–∏—Ä–∞–µ–º –±–æ–Ω—É—Å—ã
    setPlayer(prev => {
      let newStats = { ...prev };
      if (item.strength) newStats.strength -= item.strength;
      if (item.intelligence) newStats.intelligence -= item.intelligence;
      if (item.luck) newStats.luck -= item.luck;
      if (item.maxHealth) newStats.maxHealth -= item.maxHealth;
      return newStats;
    });

    addNotification(`‚úÖ –°–Ω—è—Ç–æ: ${item.name}`, 'success');
  };

  // –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  const depositToBank = () => {
    const amount = parseInt(bankAccount.depositAmount);
    if (isNaN(amount) || amount <= 0) {
      addNotification('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞', 'error');
      return;
    }
    if (player.gold < amount) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞', 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold - amount }));
    setBankAccount(prev => ({ ...prev, balance: prev.balance + amount, depositAmount: '' }));
    addNotification(`‚úÖ –í–Ω–µ—Å–µ–Ω–æ ${amount} –∑–æ–ª–æ—Ç–∞ –≤ –±–∞–Ω–∫`, 'success');
  };

  const withdrawFromBank = () => {
    const amount = parseInt(bankAccount.withdrawAmount);
    if (isNaN(amount) || amount <= 0) {
      addNotification('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞', 'error');
      return;
    }
    if (bankAccount.balance < amount) {
      addNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –±–∞–Ω–∫–µ', 'error');
      return;
    }

    setPlayer(prev => ({ ...prev, gold: prev.gold + amount }));
    setBankAccount(prev => ({ ...prev, balance: prev.balance - amount, withdrawAmount: '' }));
    addNotification(`‚úÖ –°–Ω—è—Ç–æ ${amount} –∑–æ–ª–æ—Ç–∞ –∏–∑ –±–∞–Ω–∫–∞`, 'success');
  };

  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
  useEffect(() => {
    const interval = setInterval(() => {
      setPlayer(prev => {
        if (prev.energy < prev.maxEnergy) {
          const newEnergy = Math.min(prev.energy + 1, prev.maxEnergy);
          if (newEnergy === prev.maxEnergy) updateQuest('energy');
          return { ...prev, energy: newEnergy };
        }
        return prev;
      });
    }, 5000);

    return () => clearInterval(interval);
  }, [updateQuest]);

  // –†–µ–Ω–¥–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  const renderProfile = () => (
    <div className="space-y-4">
      <div className="bg-gray-800 rounded-lg p-6 border-2 border-red-900">
        <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
          <div className="flex items-center justify-between mb-2">
            <TrendingUp className="w-6 h-6 text-green-500" />
            <span className="text-gray-400 text-sm">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</span>
          </div>
          <p className="text-2xl font-bold text-green-400">{player.totalEarned}</p>
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h3 className="text-lg font-bold text-red-400 mb-3">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
        <div className="grid grid-cols-3 gap-3">
          <div className="text-center">
            <Sword className="w-6 h-6 text-red-500 mx-auto mb-1" />
            <p className="text-sm text-gray-400">–°–∏–ª–∞</p>
            <p className="text-xl font-bold text-white">{player.strength}</p>
          </div>
          <div className="text-center">
            <Star className="w-6 h-6 text-blue-500 mx-auto mb-1" />
            <p className="text-sm text-gray-400">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</p>
            <p className="text-xl font-bold text-white">{player.intelligence}</p>
          </div>
          <div className="text-center">
            <Gift className="w-6 h-6 text-purple-500 mx-auto mb-1" />
            <p className="text-sm text-gray-400">–£–¥–∞—á–∞</p>
            <p className="text-xl font-bold text-white">{player.luck}</p>
          </div>
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h3 className="text-lg font-bold text-red-400 mb-3">–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h3>
        <div className="space-y-2">
          {['weapon', 'armor', 'accessory'].map(slot => (
            <div key={slot} className="flex items-center justify-between bg-gray-700 p-3 rounded">
              <div className="flex items-center space-x-3">
                {slot === 'weapon' && <Sword className="w-5 h-5 text-red-400" />}
                {slot === 'armor' && <Shield className="w-5 h-5 text-blue-400" />}
                {slot === 'accessory' && <Star className="w-5 h-5 text-purple-400" />}
                <div>
                  <p className="text-sm text-gray-400 capitalize">
                    {slot === 'weapon' ? '–û—Ä—É–∂–∏–µ' : slot === 'armor' ? '–ë—Ä–æ–Ω—è' : '–ê–∫—Å–µ—Å—Å—É–∞—Ä'}
                  </p>
                  {equippedItems[slot] ? (
                    <p className="text-white font-semibold">{equippedItems[slot].icon} {equippedItems[slot].name}</p>
                  ) : (
                    <p className="text-gray-500 italic">–ü—É—Å—Ç–æ</p>
                  )}
                </div>
              </div>
              {equippedItems[slot] && (
                <button
                  onClick={() => unequipItem(slot)}
                  className="px-3 py-1 bg-red-700 hover:bg-red-600 rounded text-white text-sm"
                >
                  –°–Ω—è—Ç—å
                </button>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const renderWork = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üíº –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h2>
        <p className="text-gray-400 text-sm">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ä–∞–±–æ—Ç—ã, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –∑–æ–ª–æ—Ç–æ –∏ –æ–ø—ã—Ç</p>
      </div>

      {jobs.map(job => {
        const isLocked = job.requiredLevel && player.level < job.requiredLevel;
        const lastTime = lastWorkTime[job.id] || 0;
        const now = Date.now();
        const canWork = now - lastTime >= job.time;
        const remaining = canWork ? 0 : Math.ceil((job.time - (now - lastTime)) / 1000);

        return (
          <div key={job.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${isLocked ? 'border-gray-700 opacity-50' : 'border-red-900'}`}>
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center space-x-3">
                <div className="text-4xl">{job.icon}</div>
                <div>
                  <h3 className="text-lg font-bold text-white">{job.name}</h3>
                  <div className="flex items-center space-x-2 text-sm">
                    <span className="text-yellow-400">+{job.income} üí∞</span>
                    <span className="text-purple-400">+{job.exp} ‚≠ê</span>
                    <span className="text-red-400">-{job.energy} ‚ö°</span>
                  </div>
                </div>
              </div>
              {isLocked && <Lock className="w-6 h-6 text-gray-500" />}
            </div>

            {isLocked ? (
              <div className="bg-gray-700 text-center py-2 rounded text-gray-400">
                –¢—Ä–µ–±—É–µ—Ç—Å—è {job.requiredLevel} —É—Ä–æ–≤–µ–Ω—å
              </div>
            ) : (
              <button
                onClick={() => performWork(job)}
                disabled={!canWork || player.energy < job.energy}
                className={`w-full py-2 rounded font-semibold transition-all ${
                  canWork && player.energy >= job.energy
                    ? 'bg-red-600 hover:bg-red-700 text-white'
                    : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                }`}
              >
                {!canWork ? `–û–∂–∏–¥–∞–Ω–∏–µ ${remaining}—Å` : player.energy < job.energy ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏' : '–†–∞–±–æ—Ç–∞—Ç—å'}
              </button>
            )}
          </div>
        );
      })}
    </div>
  );

  const renderInventory = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
        <p className="text-gray-400 text-sm">–ü—Ä–µ–¥–º–µ—Ç–æ–≤: {inventory.length}</p>
      </div>

      {inventory.length === 0 ? (
        <div className="bg-gray-800 rounded-lg p-8 text-center border border-red-900">
          <Package className="w-16 h-16 text-gray-600 mx-auto mb-3" />
          <p className="text-gray-400">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>
          <p className="text-gray-500 text-sm">–ö—É–ø–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ</p>
        </div>
      ) : (
        <div className="grid grid-cols-1 gap-3">
          {inventory.map(item => (
            <div key={item.id} className="bg-gray-800 rounded-lg p-4 border border-red-900">
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center space-x-3">
                  <div className="text-3xl">{item.icon}</div>
                  <div>
                    <h3 className="font-bold text-white">{item.name}</h3>
                    <p className="text-sm text-gray-400 capitalize">{
                      item.type === 'weapon' ? '–û—Ä—É–∂–∏–µ' :
                      item.type === 'armor' ? '–ë—Ä–æ–Ω—è' :
                      item.type === 'accessory' ? '–ê–∫—Å–µ—Å—Å—É–∞—Ä' : '–†–∞—Å—Ö–æ–¥–Ω–∏–∫'
                    }</p>
                  </div>
                </div>
                <button
                  onClick={() => equipItem(item)}
                  className="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white font-semibold"
                >
                  {item.type === 'consumable' ? '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å' : '–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å'}
                </button>
              </div>
              <div className="flex flex-wrap gap-2 text-sm">
                {item.strength && <span className="text-red-400">+{item.strength} üí™ –°–∏–ª–∞</span>}
                {item.intelligence && <span className="text-blue-400">+{item.intelligence} üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</span>}
                {item.luck && <span className="text-purple-400">+{item.luck} üçÄ –£–¥–∞—á–∞</span>}
                {item.maxHealth && <span className="text-green-400">+{item.maxHealth} ‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</span>}
                {item.value && <span className="text-yellow-400">+{item.value} {item.effect === 'health' ? '‚ù§Ô∏è' : item.effect === 'energy' ? '‚ö°' : '‚≠ê'}</span>}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );

  const renderMarket = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üè™ –†—ã–Ω–æ–∫</h2>
        <div className="flex items-center justify-between">
          <p className="text-gray-400 text-sm">–ü–æ–∫—É–ø–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</p>
          <div className="flex items-center space-x-2">
            <Coins className="w-5 h-5 text-yellow-500" />
            <span className="text-yellow-400 font-bold">{player.gold}</span>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 gap-3">
        {marketItems.map(item => {
          const isLocked = item.requiredLevel && player.level < item.requiredLevel;
          const canAfford = player.gold >= item.price;

          return (
            <div key={item.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${isLocked ? 'border-gray-700 opacity-50' : canAfford ? 'border-red-900' : 'border-gray-700'}`}>
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center space-x-3">
                  <div className="text-3xl">{item.icon}</div>
                  <div>
                    <h3 className="font-bold text-white">{item.name}</h3>
                    <p className="text-sm text-gray-400 capitalize">{
                      item.type === 'weapon' ? '–û—Ä—É–∂–∏–µ' :
                      item.type === 'armor' ? '–ë—Ä–æ–Ω—è' :
                      item.type === 'accessory' ? '–ê–∫—Å–µ—Å—Å—É–∞—Ä' : '–†–∞—Å—Ö–æ–¥–Ω–∏–∫'
                    }</p>
                  </div>
                </div>
                <div className="text-right">
                  <div className="flex items-center space-x-1">
                    <Coins className="w-5 h-5 text-yellow-500" />
                    <span className={`font-bold ${canAfford ? 'text-yellow-400' : 'text-red-500'}`}>{item.price}</span>
                  </div>
                  {isLocked && (
                    <div className="flex items-center space-x-1 mt-1">
                      <Lock className="w-4 h-4 text-gray-500" />
                      <span className="text-xs text-gray-500">–£—Ä.{item.requiredLevel}</span>
                    </div>
                  )}
                </div>
              </div>

              <div className="flex flex-wrap gap-2 text-sm mb-3">
                {item.strength && <span className="text-red-400">+{item.strength} üí™</span>}
                {item.intelligence && <span className="text-blue-400">+{item.intelligence} üß†</span>}
                {item.luck && <span className="text-purple-400">+{item.luck} üçÄ</span>}
                {item.maxHealth && <span className="text-green-400">+{item.maxHealth} ‚ù§Ô∏è</span>}
                {item.value && <span className="text-yellow-400">+{item.value} {item.effect === 'health' ? '‚ù§Ô∏è' : item.effect === 'energy' ? '‚ö°' : '‚≠ê'}</span>}
              </div>

              <button
                onClick={() => buyItem(item)}
                disabled={!canAfford || isLocked}
                className={`w-full py-2 rounded font-semibold transition-all ${
                  canAfford && !isLocked
                    ? 'bg-red-600 hover:bg-red-700 text-white'
                    : 'bg-gray-700 text-gray-500 cursor-not-allowed'
                }`}
              >
                {isLocked ? `–¢—Ä–µ–±—É–µ—Ç—Å—è ${item.requiredLevel} —É—Ä.` : !canAfford ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞' : '–ö—É–ø–∏—Ç—å'}
              </button>
            </div>
          );
        })}
      </div>
    </div>
  );

  const renderBank = () => (
    <div className="space-y-4">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üè¶ –ë–∞–Ω–∫</h2>
        <p className="text-gray-400 text-sm">–•—Ä–∞–Ω–∏—Ç–µ –∑–æ–ª–æ—Ç–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</p>
      </div>

      <div className="bg-gray-800 rounded-lg p-6 border-2 border-red-900">
        <div className="text-center mb-6">
          <DollarSign className="w-16 h-16 text-yellow-500 mx-auto mb-3" />
          <p className="text-gray-400 mb-2">–ë–∞–ª–∞–Ω—Å –≤ –±–∞–Ω–∫–µ</p>
          <p className="text-4xl font-bold text-yellow-400">{bankAccount.balance}</p>
        </div>

        <div className="space-y-4">
          <div>
            <label className="block text-gray-400 mb-2 text-sm">–í–Ω–µ—Å—Ç–∏ –≤ –±–∞–Ω–∫</label>
            <div className="flex space-x-2">
              <input
                type="number"
                value={bankAccount.depositAmount}
                onChange={(e) => setBankAccount(prev => ({ ...prev, depositAmount: e.target.value }))}
                placeholder="–°—É–º–º–∞"
                className="flex-1 px-4 py-2 bg-gray-700 border border-red-900 rounded text-white"
              />
              <button
                onClick={depositToBank}
                className="px-6 py-2 bg-green-600 hover:bg-green-700 rounded text-white font-semibold"
              >
                –í–Ω–µ—Å—Ç–∏
              </button>
            </div>
            <p className="text-xs text-gray-500 mt-1">–î–æ—Å—Ç—É–ø–Ω–æ: {player.gold} –∑–æ–ª–æ—Ç–∞</p>
          </div>

          <div>
            <label className="block text-gray-400 mb-2 text-sm">–°–Ω—è—Ç—å –∏–∑ –±–∞–Ω–∫–∞</label>
            <div className="flex space-x-2">
              <input
                type="number"
                value={bankAccount.withdrawAmount}
                onChange={(e) => setBankAccount(prev => ({ ...prev, withdrawAmount: e.target.value }))}
                placeholder="–°—É–º–º–∞"
                className="flex-1 px-4 py-2 bg-gray-700 border border-red-900 rounded text-white"
              />
              <button
                onClick={withdrawFromBank}
                className="px-6 py-2 bg-red-600 hover:bg-red-700 rounded text-white font-semibold"
              >
                –°–Ω—è—Ç—å
              </button>
            </div>
            <p className="text-xs text-gray-500 mt-1">–í –±–∞–Ω–∫–µ: {bankAccount.balance} –∑–æ–ª–æ—Ç–∞</p>
          </div>
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h3 className="font-bold text-red-400 mb-2">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <ul className="text-sm text-gray-400 space-y-1">
          <li>‚Ä¢ –•—Ä–∞–Ω–∏—Ç–µ –∑–æ–ª–æ—Ç–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</li>
          <li>‚Ä¢ –ë–∞–Ω–∫ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä—å</li>
          <li>‚Ä¢ –°–Ω–∏–º–∞–π—Ç–µ –∫–æ–≥–¥–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è</li>
        </ul>
      </div>
    </div>
  );

  const renderQuests = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üìã –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã</h2>
        <p className="text-gray-400 text-sm">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–≤–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥</p>
      </div>

      {dailyQuests.map(quest => (
        <div key={quest.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${quest.completed ? 'border-green-600' : 'border-red-900'}`}>
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center space-x-3">
              <div className="text-3xl">{quest.icon}</div>
              <div>
                <h3 className="font-bold text-white">{quest.name}</h3>
                <p className="text-sm text-gray-400">–ù–∞–≥—Ä–∞–¥–∞: {quest.reward} üí∞ + {quest.exp} ‚≠ê</p>
              </div>
            </div>
            {quest.completed && <CheckCircle className="w-6 h-6 text-green-500" />}
          </div>

          <div className="mb-2">
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
              <span className="text-red-400">{quest.current}/{quest.target}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div 
                className={`h-2 rounded-full transition-all ${quest.completed ? 'bg-green-500' : 'bg-red-500'}`}
                style={{ width: `${Math.min((quest.current / quest.target) * 100, 100)}%` }}
              ></div>
            </div>
          </div>
        </div>
      ))}

      <button
        onClick={() => setDailyQuests(generateDailyQuests())}
        className="w-full py-3 bg-red-600 hover:bg-red-700 rounded text-white font-semibold"
      >
        üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–≤–µ—Å—Ç—ã
      </button>
    </div>
  );

  const renderAchievements = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
        <p className="text-gray-400 text-sm">–ü–æ–ª—É—á–µ–Ω–æ: {achievements.length}/{achievementsList.length}</p>
      </div>

      {achievementsList.map(achievement => {
        const unlocked = achievements.includes(achievement.id);
        let progress = 0;

        switch (achievement.type) {
          case 'clicks':
            progress = player.totalClicks;
            break;
          case 'earned':
            progress = player.totalEarned;
            break;
          case 'level':
            progress = player.level;
            break;
          case 'quests':
            progress = dailyQuests.filter(q => q.completed).length;
            break;
          default:
            break;
        }

        return (
          <div key={achievement.id} className={`bg-gray-800 rounded-lg p-4 border-2 ${unlocked ? 'border-yellow-600' : 'border-gray-700'} ${!unlocked && 'opacity-60'}`}>
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center space-x-3">
                <div className="text-3xl">{achievement.icon}</div>
                <div>
                  <h3 className="font-bold text-white flex items-center space-x-2">
                    <span>{achievement.name}</span>
                    {unlocked && <Award className="w-5 h-5 text-yellow-500" />}
                  </h3>
                  <p className="text-sm text-gray-400">{achievement.desc}</p>
                </div>
              </div>
            </div>

            <div className="mb-2">
              <div className="flex justify-between text-sm mb-1">
                <span className="text-gray-400">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                <span className={unlocked ? 'text-yellow-400' : 'text-red-400'}>
                  {Math.min(progress, achievement.requirement)}/{achievement.requirement}
                </span>
              </div>
              <div className="w-full bg-gray-700 rounded-full h-2">
                <div 
                  className={`h-2 rounded-full transition-all ${unlocked ? 'bg-yellow-500' : 'bg-red-500'}`}
                  style={{ width: `${Math.min((progress / achievement.requirement) * 100, 100)}%` }}
                ></div>
              </div>
            </div>

            {unlocked && (
              <div className="bg-yellow-900 bg-opacity-30 rounded p-2 text-center">
                <span className="text-yellow-400 font-semibold">–ù–∞–≥—Ä–∞–¥–∞: {achievement.reward} üí∞</span>
              </div>
            )}
          </div>
        );
      })}
    </div>
  );

  const renderLeaderboard = () => (
    <div className="space-y-3">
      <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
        <h2 className="text-xl font-bold text-red-400 mb-2">üë• –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
        <p className="text-gray-400 text-sm">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º—É –∑–æ–ª–æ—Ç—É</p>
      </div>

      {leaderboard.length === 0 ? (
        <div className="bg-gray-800 rounded-lg p-8 text-center border border-red-900">
          <Users className="w-16 h-16 text-gray-600 mx-auto mb-3" />
          <p className="text-gray-400">–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç</p>
          <p className="text-gray-500 text-sm">–ù–∞—á–Ω–∏—Ç–µ –∏–≥—Ä–∞—Ç—å, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ —Ç–æ–ø!</p>
        </div>
      ) : (
        <div className="space-y-2">
          {leaderboard.map((p, index) => (
            <div 
              key={p.telegramId} 
              className={`bg-gray-800 rounded-lg p-4 border-2 ${
                p.telegramId === player.telegramId ? 'border-red-500' : 'border-red-900'
              }`}
            >
              <div className="flex items-center space-x-3">
                <div className="text-2xl font-bold w-8 text-center">
                  {index === 0 && 'ü•á'}
                  {index === 1 && 'ü•à'}
                  {index === 2 && 'ü•â'}
                  {index > 2 && <span className="text-gray-400">{index + 1}</span>}
                </div>

                {p.photoUrl ? (
                  <img src={p.photoUrl} alt="Avatar" className="w-12 h-12 rounded-full border-2 border-red-500" />
                ) : (
                  <div className="w-12 h-12 rounded-full bg-red-900 flex items-center justify-center border-2 border-red-500">
                    <Users className="w-6 h-6 text-red-300" />
                  </div>
                )}

                <div className="flex-1">
                  <h3 className="font-bold text-white">{p.username}</h3>
                  <div className="flex items-center space-x-3 text-sm">
                    <span className="text-gray-400">–£—Ä. {p.level}</span>
                    <span className="text-yellow-400">{p.totalEarned} üí∞</span>
                  </div>
                </div>

                {p.telegramId === player.telegramId && (
                  <Medal className="w-6 h-6 text-red-500" />
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-900 to-black text-white pb-20">
      {/* –ê–Ω–∏–º–∞—Ü–∏–∏ –∫–ª–∏–∫–æ–≤ */}
      {clickAnimations.map(anim => (
        <div
          key={anim.id}
          className="fixed text-2xl font-bold text-yellow-400 pointer-events-none animate-bounce"
          style={{
            left: anim.x,
            top: anim.y,
            animation: 'float-up 1s ease-out forwards'
          }}
        >
          {anim.text}
        </div>
      ))}

      {/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */}
      <div className="fixed top-4 right-4 z-50 space-y-2">
        {notifications.map(notif => (
          <div
            key={notif.id}
            className={`px-4 py-3 rounded-lg shadow-lg max-w-sm animate-slide-in ${
              notif.type === 'success' ? 'bg-green-600' :
              notif.type === 'error' ? 'bg-red-600' :
              notif.type === 'warning' ? 'bg-yellow-600' :
              notif.type === 'achievement' ? 'bg-purple-600' :
              'bg-blue-600'
            }`}
          >
            <p className="text-white font-semibold">{notif.message}</p>
          </div>
        ))}
      </div>

      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
      <div className="bg-gradient-to-r from-red-900 to-gray-900 p-4 shadow-lg border-b-2 border-red-700">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold text-red-400">‚öîÔ∏è –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è RPG</h1>
            <p className="text-sm text-gray-400">–£—Ä–æ–≤–µ–Ω—å {player.level} ‚Ä¢ {player.gold} üí∞</p>
          </div>
          <div className="flex items-center space-x-2">
            <div className="text-right">
              <p className="text-xs text-gray-400">–≠–Ω–µ—Ä–≥–∏—è</p>
              <p className="text-sm font-bold text-yellow-400">{player.energy}/{player.maxEnergy}</p>
            </div>
          </div>
        </div>
      </div>

      {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
      <div className="p-4 max-w-2xl mx-auto">
        {activeTab === 'profile' && renderProfile()}
        {activeTab === 'work' && renderWork()}
        {activeTab === 'inventory' && renderInventory()}
        {activeTab === 'market' && renderMarket()}
        {activeTab === 'bank' && renderBank()}
        {activeTab === 'quests' && renderQuests()}
        {activeTab === 'achievements' && renderAchievements()}
        {activeTab === 'leaderboard' && renderLeaderboard()}
      </div>

      {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
      <div className="fixed bottom-0 left-0 right-0 bg-gray-900 border-t-2 border-red-900 shadow-lg">
        <div className="flex justify-around py-2 max-w-2xl mx-auto">
          {[
            { id: 'profile', icon: Users, label: '–ü—Ä–æ—Ñ–∏–ª—å' },
            { id: 'work', icon: Briefcase, label: '–†–∞–±–æ—Ç–∞' },
            { id: 'inventory', icon: Package, label: '–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å' },
            { id: 'market', icon: ShoppingCart, label: '–†—ã–Ω–æ–∫' },
            { id: 'bank', icon: DollarSign, label: '–ë–∞–Ω–∫' },
            { id: 'quests', icon: Target, label: '–ö–≤–µ—Å—Ç—ã' },
            { id: 'achievements', icon: Trophy, label: '–ù–∞–≥—Ä–∞–¥—ã' },
            { id: 'leaderboard', icon: Medal, label: '–†–µ–π—Ç–∏–Ω–≥' }
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`flex flex-col items-center space-y-1 px-2 py-1 rounded transition-all ${
                activeTab === tab.id ? 'text-red-400' : 'text-gray-400 hover:text-red-300'
              }`}
            >
              <tab.icon className="w-5 h-5" />
              <span className="text-xs">{tab.label}</span>
            </button>
          ))}
        </div>
      </div>

      {/* CSS –∞–Ω–∏–º–∞—Ü–∏–∏ */}
      <style jsx>{`
        @keyframes float-up {
          0% {
            opacity: 1;
            transform: translateY(0);
          }
          100% {
            opacity: 0;
            transform: translateY(-100px);
          }
        }

        @keyframes slide-in {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        .animate-slide-in {
          animation: slide-in 0.3s ease-out;
        }

        @keyframes pulse {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.5;
          }
        }

        .animate-pulse {
          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes bounce {
          0%, 100% {
            transform: translateY(-25%);
            animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
          }
          50% {
            transform: translateY(0);
            animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
          }
        }

        .animate-bounce {
          animation: bounce 1s infinite;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
          width: 8px;
        }

        ::-webkit-scrollbar-track {
          background: #1f2937;
        }

        ::-webkit-scrollbar-thumb {
          background: #7f1d1d;
          border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
          background: #991b1b;
        }

        /* –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ UX */
        * {
          -webkit-tap-highlight-color: transparent;
          -webkit-touch-callout: none;
          -webkit-user-select: none;
          user-select: none;
        }

        input {
          -webkit-user-select: text;
          user-select: text;
        }

        /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
        button {
          transition: all 0.2s ease;
        }

        button:active {
          transform: scale(0.95);
        }

        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .bg-gray-800 {
          background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        /* –°–≤–µ—á–µ–Ω–∏–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .border-red-900 {
          box-shadow: 0 0 10px rgba(127, 29, 29, 0.3);
        }

        .border-red-500 {
          box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        @keyframes glow {
          0%, 100% {
            box-shadow: 0 0 5px rgba(239, 68, 68, 0.5);
          }
          50% {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.8);
          }
        }

        .bg-red-600:hover {
          animation: glow 2s ease-in-out infinite;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 640px) {
          .text-2xl {
            font-size: 1.25rem;
          }

          .text-xl {
            font-size: 1.125rem;
          }

          .p-6 {
            padding: 1rem;
          }

          .space-y-4 > * + * {
            margin-top: 0.75rem;
          }
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
        @keyframes shine {
          0% {
            background-position: -100px;
          }
          100% {
            background-position: 200px;
          }
        }

        .border-yellow-600 {
          background: linear-gradient(
            90deg,
            transparent 0%,
            rgba(202, 138, 4, 0.1) 50%,
            transparent 100%
          );
          background-size: 200px 100%;
          animation: shine 3s ease-in-out infinite;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ */
        @keyframes energy-pulse {
          0%, 100% {
            opacity: 1;
            transform: scale(1);
          }
          50% {
            opacity: 0.8;
            transform: scale(1.05);
          }
        }

        .bg-yellow-500 {
          animation: energy-pulse 1.5s ease-in-out infinite;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è */
        @keyframes health-pulse {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.7;
          }
        }

        .bg-red-600 {
          animation: health-pulse 2s ease-in-out infinite;
        }

        /* –¢–µ–Ω–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .bg-gray-800:hover {
          transform: translateY(-2px);
          transition: transform 0.2s ease;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∑–æ–ª–æ—Ç–∞ */
        @keyframes gold-shine {
          0%, 100% {
            text-shadow: 0 0 5px rgba(251, 191, 36, 0.5);
          }
          50% {
            text-shadow: 0 0 15px rgba(251, 191, 36, 0.8);
          }
        }

        .text-yellow-400 {
          animation: gold-shine 2s ease-in-out infinite;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        @keyframes spin {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }

        .animate-spin {
          animation: spin 1s linear infinite;
        }

        /* –§–æ–Ω –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .bg-gradient-to-b {
          background: linear-gradient(
            to bottom,
            #111827 0%,
            #1f2937 25%,
            #111827 50%,
            #000000 100%
          );
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Ç–æ–ø-3 –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ */
        .border-yellow-600::before {
          content: '';
          position: absolute;
          top: -2px;
          left: -2px;
          right: -2px;
          bottom: -2px;
          background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706, #fbbf24);
          border-radius: 0.5rem;
          z-index: -1;
          opacity: 0.3;
          animation: border-glow 3s ease-in-out infinite;
        }

        @keyframes border-glow {
          0%, 100% {
            opacity: 0.3;
          }
          50% {
            opacity: 0.6;
          }
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .opacity-50 {
          filter: grayscale(50%);
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .h-2 {
          position: relative;
          overflow: hidden;
        }

        .h-2::after {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.3),
            transparent
          );
          animation: progress-shine 2s ease-in-out infinite;
        }

        @keyframes progress-shine {
          0% {
            left: -100%;
          }
          100% {
            left: 100%;
          }
        }

        /* –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .fixed.bottom-0 button:active {
          background: rgba(127, 29, 29, 0.3);
          border-radius: 0.5rem;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ –æ–≤–µ—Ä–ª–µ–∏ */
        .backdrop-blur {
          backdrop-filter: blur(4px);
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        @keyframes card-hover {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-5px);
          }
        }

        .hover\:shadow-xl:hover {
          box-shadow: 0 20px 25px -5px rgba(127, 29, 29, 0.3),
                      0 10px 10px -5px rgba(127, 29, 29, 0.2);
          animation: card-hover 0.5s ease-in-out;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–µ–Ω–∏ */
        .shadow-lg {
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5),
                      0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∏–∫–æ–Ω–æ–∫ */
        @keyframes icon-bounce {
          0%, 100% {
            transform: scale(1);
          }
          50% {
            transform: scale(1.1);
          }
        }

        button:hover svg {
          animation: icon-bounce 0.5s ease-in-out;
        }

        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
        .text-gradient {
          background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ñ–æ–∫—É—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ */
        button:focus-visible {
          outline: 2px solid #ef4444;
          outline-offset: 2px;
        }

        /* –ü–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        button, input, .bg-gray-800 {
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Ä–∏–ø–ª –ø—Ä–∏ –∫–ª–∏–∫–µ */
        @keyframes ripple {
          0% {
            transform: scale(0);
            opacity: 1;
          }
          100% {
            transform: scale(4);
            opacity: 0;
          }
        }

        button::after {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          width: 5px;
          height: 5px;
          background: rgba(255, 255, 255, 0.5);
          border-radius: 50%;
          transform: translate(-50%, -50%) scale(0);
          pointer-events: none;
        }

        button:active::after {
          animation: ripple 0.6s ease-out;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è input */
        input:focus {
          outline: none;
          border-color: #ef4444;
          box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }

        /* –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
        html {
          scroll-behavior: smooth;
        }

        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
        * {
          will-change: auto;
        }

        button, .bg-gray-800 {
          will-change: transform;
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        ::selection {
          background: #7f1d1d;
          color: white;
        }

        /* –ö—É—Ä—Å–æ—Ä */
        button {
          cursor: pointer;
        }

        button:disabled {
          cursor: not-allowed;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
        @media (max-width: 768px) {
          .p-4 {
            padding: 0.75rem;
          }

          .space-y-3 > * + * {
            margin-top: 0.5rem;
          }
        }

        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å */
        body {
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –º–µ–¥–∞–ª–µ–π */
        @keyframes medal-spin {
          from {
            transform: rotateY(0deg);
          }
          to {
            transform: rotateY(360deg);
          }
        }

        .text-yellow-500:hover {
          animation: medal-spin 1s ease-in-out;
        }

        /* –§–∏–Ω–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏ */
        .max-w-2xl {
          max-width: 42rem;
        }

        /* –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ –¥–ª—è iOS */
        @supports (padding: max(0px)) {
          .pb-20 {
            padding-bottom: max(5rem, env(safe-area-inset-bottom));
          }

          .fixed.bottom-0 {
            padding-bottom: env(safe-area-inset-bottom);
          }
        }
      `}</style>
    </div>
  );
};

export default MedievalRPG;="flex items-center space-x-4 mb-4">
          {player.photoUrl ? (
            <img src={player.photoUrl} alt="Avatar" className="w-20 h-20 rounded-full border-2 border-red-500" />
          ) : (
            <div className="w-20 h-20 rounded-full bg-red-900 flex items-center justify-center border-2 border-red-500">
              <Users className="w-10 h-10 text-red-300" />
            </div>
          )}
          <div className="flex-1">
            <h2 className="text-2xl font-bold text-red-400">{player.firstName}</h2>
            <p className="text-gray-400">@{player.username}</p>
            <div className="flex items-center space-x-2 mt-2">
              <Crown className="w-5 h-5 text-yellow-500" />
              <span className="text-white font-semibold">–£—Ä–æ–≤–µ–Ω—å {player.level}</span>
            </div>
          </div>
        </div>

        <div className="space-y-3">
          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400">–û–ø—ã—Ç</span>
              <span className="text-red-400">{Math.floor(player.exp)}/{Math.floor(player.expToNext)}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-red-500 h-2 rounded-full transition-all" style={{ width: `${(player.exp / player.expToNext) * 100}%` }}></div>
            </div>
          </div>

          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400 flex items-center"><Heart className="w-4 h-4 mr-1" />–ó–¥–æ—Ä–æ–≤—å–µ</span>
              <span className="text-red-400">{player.health}/{player.maxHealth}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-red-600 h-2 rounded-full transition-all" style={{ width: `${(player.health / player.maxHealth) * 100}%` }}></div>
            </div>
          </div>

          <div>
            <div className="flex justify-between text-sm mb-1">
              <span className="text-gray-400 flex items-center"><Zap className="w-4 h-4 mr-1" />–≠–Ω–µ—Ä–≥–∏—è</span>
              <span className="text-red-400">{player.energy}/{player.maxEnergy}</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-yellow-500 h-2 rounded-full transition-all" style={{ width: `${(player.energy / player.maxEnergy) * 100}%` }}></div>
            </div>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="bg-gray-800 rounded-lg p-4 border border-red-900">
          <div className="flex items-center justify-between mb-2">
            <Coins className="w-6 h-6 text-yellow-500" />
            <span className="text-gray-400 text-sm">–ó–æ–ª–æ—Ç–æ</span>
          </div>
          <p className="text-2xl font-bold text-yellow-400">{player.gold}</p>
        </div>

        <div className
