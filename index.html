<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WAR SAGA: FINAL MONOLITH</title>
    <link href="https://fonts.googleapis.com/css2?family=Almendra:wght@400;700&family=Cinzel:wght@700;900&family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        /* --- –°–¢–ò–õ–ò (–î–ò–ó–ê–ô–ù –ò–ó –ü–ï–†–í–û–ô –í–ï–†–°–ò–ò) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        :root { --gold: #ffcc00; --gold-dark: #b8860b; --blood: #800000; --parchment: #f4e4bc; --iron: #1a1a1a; --stone: #252525; }
        
        body { background: #000; color: var(--parchment); font-family: 'Almendra', serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* –§–∏–∫—Å –ª–æ–∞–¥–µ—Ä–∞ */
        #loader { position: fixed; inset: 0; background: radial-gradient(circle, #1a0000 0%, #000 100%); z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .seal { width: 100px; height: 100px; border: 2px dashed var(--gold); border-radius: 50%; display: flex; justify-content: center; align-items: center; animation: spin 8s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .royal-header { background: linear-gradient(180deg, #1a1a1a 0%, #000 100%); border-bottom: 2px solid var(--gold-dark); padding: 12px; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.8); }
        .stats-row { display: flex; justify-content: center; gap: 15px; margin-bottom: 10px; }
        .stat-box { background: var(--stone); border: 1px solid var(--gold-dark); padding: 5px 15px; border-radius: 4px; font-family: 'MedievalSharp', cursive; display: flex; align-items: center; gap: 8px; min-width: 100px; box-shadow: inset 0 0 10px #000; }
        
        .exp-area { display: flex; align-items: center; gap: 10px; }
        .lvl-orb { width: 45px; height: 45px; background: #000; border: 2px solid var(--gold); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 0 10px var(--gold-dark); }
        .exp-track { flex: 1; height: 12px; background: #000; border: 1px solid var(--gold-dark); position: relative; overflow: hidden; }
        #exp-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #4a0000, #ff0000); transition: width 0.4s; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .main-scroll { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 90px; background: url('https://www.transparenttextures.com/patterns/dark-matter.png'); }
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .m-title { font-family: 'Cinzel', serif; text-align: center; color: var(--gold); margin: 15px 0; text-transform: uppercase; letter-spacing: 2px; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card-a { background: #151515; border: 1px solid #333; margin-bottom: 15px; border-left: 4px solid var(--gold-dark); position: relative; transition: 0.1s; }
        .card-a:active { transform: scale(0.98); background: #222; }
        .card-body { padding: 15px; display: flex; align-items: center; gap: 15px; }
        .icon-f { width: 55px; height: 55px; background: #000; border: 1px solid var(--gold-dark); display: flex; justify-content: center; align-items: center; font-size: 1.8em; box-shadow: inset 0 0 10px var(--gold-dark); }
        .c-text h3 { font-family: 'Cinzel', serif; font-size: 0.9em; color: var(--gold); }
        .c-text p { font-size: 0.8em; color: #888; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .royal-nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: #000; border-top: 2px solid var(--gold-dark); display: flex; z-index: 1000; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; text-decoration: none; transition: 0.3s; }
        .nav-btn.active { color: var(--gold); background: rgba(184,134,11,0.1); }
        .nav-btn i { font-size: 1.5em; }
        .nav-btn span { font-size: 0.6em; text-transform: uppercase; font-family: 'MedievalSharp'; margin-top: 4px; }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–π —Ç–µ–∫—Å—Ç */
        .pop-txt { position: fixed; color: var(--gold); font-weight: bold; pointer-events: none; z-index: 9999; animation: floatUp 0.8s forwards; text-shadow: 2px 2px #000; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }

        .locked { opacity: 0.3; filter: grayscale(1); pointer-events: none; }
        .btn-buy { background: var(--blood); border: 1px solid var(--gold); color: white; padding: 6px 12px; font-family: 'MedievalSharp'; cursor: pointer; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="seal"><h2 style="color:var(--gold); transform: rotate(-45deg);">WS</h2></div>
        <h1 style="color:var(--gold); font-family:'Cinzel'; margin-top:20px; letter-spacing:5px;">WAR SAGA</h1>
        <p id="l-status">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ—Ç–æ–ø–∏—Å–∏...</p>
    </div>

    <header class="royal-header">
        <div class="stats-row">
            <div class="stat-box">ü™ô <span id="g-val">0</span></div>
            <div class="stat-box">üíé <span id="d-val">0</span></div>
        </div>
        <div class="exp-area">
            <div class="lvl-orb"><span id="l-val" style="font-weight:bold; color:var(--gold);">1</span><small style="font-size:0.5em; text-transform:uppercase;">lvl</small></div>
            <div class="exp-track"><div id="exp-fill"></div></div>
        </div>
    </header>

    <main class="main-scroll">
        <section id="scr-battle" class="screen active">
            <h2 class="m-title">–†–∞—Ç–Ω—ã–µ –ü–æ–¥–≤–∏–≥–∏</h2>
            <div class="card-a" onclick="game.doWork('port', event)">
                <div class="card-body">
                    <div class="icon-f">üé£</div>
                    <div class="c-text"><h3>–†—ã–±–∞—Ü–∫–∞—è –ë—É—Ö—Ç–∞</h3><p>–ù–∞–≥—Ä–∞–¥–∞: +2 ü™ô | –û–ø—ã—Ç: +5</p></div>
                </div>
            </div>
            <div class="card-a" onclick="game.doWork('mine', event)">
                <div class="card-body">
                    <div class="icon-f">‚õèÔ∏è</div>
                    <div class="c-text"><h3>–î—Ä–µ–≤–Ω–∏–µ –†—É–¥–Ω–∏–∫–∏</h3><p>–ù–∞–≥—Ä–∞–¥–∞: +1 ü™ô | –û–ø—ã—Ç: +10</p></div>
                </div>
            </div>
            <div id="card-farm" class="card-a locked" onclick="game.doWork('farm', event)">
                <div class="card-body">
                    <div class="icon-f">üåæ</div>
                    <div class="c-text"><h3>–ò–º–ø–µ—Ä—Å–∫–∞—è –§–µ—Ä–º–∞</h3><p>–¢—Ä–µ–±—É–µ—Ç—Å—è 10 —É—Ä–æ–≤–µ–Ω—å</p></div>
                </div>
            </div>
        </section>

        <section id="scr-shop" class="screen">
            <h2 class="m-title">–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –õ–∞–≤–∫–∞</h2>
            <div class="card-a">
                <div class="card-body">
                    <div class="icon-f">üó°Ô∏è</div>
                    <div style="flex:1"><h3>–°—Ç–∞–ª—å–Ω–æ–π –ú–µ—á</h3><p>+3 –∑–æ–ª–æ—Ç–∞ –∑–∞ –∫–∞–∂–¥—ã–π –∫–ª–∏–∫</p></div>
                    <button class="btn-buy" id="b-sword" onclick="game.buy('sword', 300)">300</button>
                </div>
            </div>
            <div class="card-a">
                <div class="card-body">
                    <div class="icon-f">üë®‚Äçüåæ</div>
                    <div style="flex:1"><h3>–ù–∞–Ω—è—Ç—å –ù–∞–µ–º–Ω–∏–∫–∞</h3><p>–ü—Ä–∏–Ω–æ—Å–∏—Ç +1 ü™ô –≤ —Å–µ–∫ –ø–∞—Å—Å–∏–≤–Ω–æ</p></div>
                    <button class="btn-buy" id="b-worker" onclick="game.hire(150)">150</button>
                </div>
            </div>
        </section>
    </main>

    <nav class="royal-nav">
        <div class="nav-btn active" onclick="game.tab('battle', this)"><i>‚öîÔ∏è</i><span>–ë–∏—Ç–≤–∞</span></div>
        <div class="nav-btn" onclick="game.tab('shop', this)"><i>üí∞</i><span>–õ–∞–≤–∫–∞</span></div>
    </nav>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // --- –õ–û–ì–ò–ö–ê (–í–°–Å –í –û–î–ù–û–ú) ---
        const tg = window.Telegram.WebApp;
        const game = {
            s: { gold: 50, gems: 0, lvl: 1, xp: 0, nx: 100, sword: false, workers: 0 },

            init() {
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                const save = localStorage.getItem('WS_FINAL_SAVE');
                if (save) this.s = JSON.parse(save);
                
                tg.expand();
                tg.ready();

                // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
                setInterval(() => {
                    if (this.s.workers > 0) {
                        this.s.gold += this.s.workers;
                        this.upd();
                    }
                }, 1000);

                // –£–±–∏—Ä–∞–µ–º –ª–æ–∞–¥–µ—Ä —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫
                setTimeout(() => {
                    document.getElementById('loader').style.opacity = '0';
                    setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
                }, 1500);

                this.upd();
            },

            tab(id, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
                document.getElementById('scr-' + id).classList.add('active');
                el.classList.add('active');
                tg.HapticFeedback.impactOccurred('light');
            },

            doWork(type, e) {
                if (type === 'farm' && this.s.lvl < 10) return;

                let g = (type === 'port' ? 2 : (type === 'mine' ? 1 : 10));
                if (this.s.sword) g += 3;

                this.s.gold += g;
                this.addXp(type === 'port' ? 5 : (type === 'mine' ? 10 : 20));
                
                // –≠—Ñ—Ñ–µ–∫—Ç —Ü–∏—Ñ—Ä
                this.pop(e, `+${g} ü™ô`);
                this.upd();
                tg.HapticFeedback.impactOccurred('medium');
            },

            addXp(v) {
                this.s.xp += v;
                if (this.s.xp >= this.s.nx) {
                    this.s.lvl++;
                    this.s.xp = 0;
                    this.s.nx = Math.floor(this.s.nx * 1.6);
                    tg.showAlert("‚öîÔ∏è –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –í–∞—à–∞ —Å–∏–ª–∞ —Ä–∞—Å—Ç–µ—Ç.");
                }
            },

            buy(id, p) {
                if (this.s.sword) return tg.showAlert("–ü—Ä–µ–¥–º–µ—Ç —É–∂–µ —É –≤–∞—Å!");
                if (this.s.gold >= p) {
                    this.s.gold -= p;
                    this.s.sword = true;
                    this.upd();
                    tg.showAlert("–í—ã –∫—É–ø–∏–ª–∏ –ú–µ—á! –¢–µ–ø–µ—Ä—å –¥–æ–±—ã—á–∞ –∑–æ–ª–æ—Ç–∞ –≤—ã—à–µ.");
                } else { tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!"); }
            },

            hire(p) {
                const price = p + (this.s.workers * 30); // –¶–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç
                if (this.s.gold >= price) {
                    this.s.gold -= price;
                    this.s.workers++;
                    this.upd();
                } else { tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è –Ω–∞–π–º–∞!"); }
            },

            upd() {
                document.getElementById('g-val').innerText = Math.floor(this.s.gold);
                document.getElementById('d-val').innerText = this.s.gems;
                document.getElementById('l-val').innerText = this.s.lvl;
                document.getElementById('exp-fill').style.width = (this.s.xp / this.s.nx * 100) + "%";
                
                // –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ –Ω–∞–π–º–∞
                document.getElementById('b-worker').innerText = (150 + (this.s.workers * 30));
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ–µ—Ä–º—ã
                if (this.s.lvl >= 10) {
                    const f = document.getElementById('card-farm');
                    f.classList.remove('locked');
                    f.querySelector('p').innerText = "–ù–∞–≥—Ä–∞–¥–∞: +10 ü™ô | –û–ø—ã—Ç: +20";
                }

                if (this.s.sword) document.getElementById('b-sword').innerText = "–ö–£–ü–õ–ï–ù–û";

                localStorage.setItem('WS_FINAL_SAVE', JSON.stringify(this.s));
            },

            pop(e, txt) {
                const p = document.createElement('div');
                p.className = 'pop-txt';
                p.innerText = txt;
                const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
                const y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            }
        };

        window.onload = () => game.init();
    </script>
</body>
</html>
<section id="scr-forge" class="screen">
    <h2 style="text-align: center; color: var(--gold); margin-bottom: 15px; font-family: 'Cinzel';">–ö–£–ó–ù–ò–¶–ê</h2>
    <div class="card" style="flex-direction: column; align-items: stretch;">
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
            <div class="icon-box" id="forge-icon">üó°Ô∏è</div>
            <div class="info">
                <h3>–£–ª—É—á—à–µ–Ω–∏–µ –º–µ—á–∞</h3>
                <p id="sword-lvl-text">–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: 0</p>
                <p id="sword-boost-text">–ë–æ–Ω—É—Å: +0 ü™ô –∫ –∫–ª–∏–∫—É</p>
            </div>
        </div>
        <button class="btn" onclick="game.upgradeSword()">–ó–ê–¢–û–ß–ò–¢–¨ –ó–ê <span id="forge-cost">500</span> ü™ô</button>
    </div>
</section>

<section id="scr-market" class="screen">
    <h2 style="text-align: center; color: var(--gold); margin-bottom: 15px; font-family: 'Cinzel';">–ß–ï–†–ù–´–ô –†–´–ù–û–ö</h2>
    <div class="card" style="background: rgba(40, 20, 0, 0.4);">
        <div class="info" style="width: 100%;">
            <p style="text-align: center; font-style: italic; color: var(--gold-dark); margin-bottom: 10px;">–¶–µ–Ω—ã –º–µ–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥!</p>
            <div style="display: flex; justify-content: space-around; align-items: center;">
                <div>
                    <p>–ö—É—Ä—Å –ø—Ä–æ–¥–∞–∂–∏ üíé</p>
                    <h3 id="gem-sell-price" style="color: var(--gold);">400 ü™ô</h3>
                </div>
                <div style="height: 40px; width: 1px; background: var(--gold-dark);"></div>
                <div>
                    <p>–ö—É—Ä—Å –ø–æ–∫—É–ø–∫–∏ üíé</p>
                    <h3 id="gem-buy-price" style="color: var(--emerald);">600 ü™ô</h3>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn" style="flex: 1;" onclick="game.marketDeal('buy')">–ö–£–ü–ò–¢–¨</button>
                <button class="btn" style="flex: 1; background: #333;" onclick="game.marketDeal('sell')">–ü–†–û–î–ê–¢–¨</button>
            </div>
        </div>
    </div>
</
    // –í –æ–±—ä–µ–∫—Ç s (state) –¥–æ–±–∞–≤—å:
s: { 
    // ... —Ç–≤–æ–∏ –ø—Ä–æ—à–ª—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ...
    swordLvl: 0,
    marketPrices: { buy: 600, sell: 400 },
    lastPriceUpdate: 0
},

// –í –æ–±—ä–µ–∫—Ç game –¥–æ–±–∞–≤—å —ç—Ç–∏ –º–µ—Ç–æ–¥—ã:

// –õ–û–ì–ò–ö–ê –ö–£–ó–ù–ò–¶–´
upgradeSword() {
    const cost = (this.s.swordLvl + 1) * 500;
    if (this.s.gold >= cost) {
        this.s.gold -= cost;
        this.s.swordLvl++;
        this.alert(`–ú–µ—á –∑–∞–∫–∞–ª–µ–Ω –¥–æ —É—Ä–æ–≤–Ω—è ${this.s.swordLvl}!`);
        this.upd();
        tg.HapticFeedback.notificationOccurred('success');
    } else {
        this.alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è –∫–æ–≤–∫–∏!");
    }
},

// –õ–û–ì–ò–ö–ê –†–´–ù–ö–ê
updateMarket() {
    const now = Date.now();
    if (now - this.s.lastPriceUpdate > 30000) { // 30 —Å–µ–∫—É–Ω–¥
        const base = 500;
        const volatility = Math.floor(Math.random() * 200) - 100; // -100 –¥–æ +100
        this.s.marketPrices.buy = base + volatility + 50;
        this.s.marketPrices.sell = base + volatility - 50;
        this.s.lastPriceUpdate = now;
        console.log("–¶–µ–Ω—ã –Ω–∞ —Ä—ã–Ω–∫–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å");
    }
},

marketDeal(type) {
    if (type === 'buy') {
        if (this.s.gold >= this.s.marketPrices.buy) {
            this.s.gold -= this.s.marketPrices.buy;
            this.s.gems++;
            this.alert("–ò–∑—É–º—Ä—É–¥ –∫—É–ø–ª–µ–Ω!");
        } else { this.alert("–ú–∞–ª–æ –∑–æ–ª–æ—Ç–∞!"); }
    } else {
        if (this.s.gems >= 1) {
            this.s.gems--;
            this.s.gold += this.s.marketPrices.sell;
            this.alert("–ò–∑—É–º—Ä—É–¥ –ø—Ä–æ–¥–∞–Ω!");
        } else { this.alert("–£ –≤–∞—Å –Ω–µ—Ç –∏–∑—É–º—Ä—É–¥–æ–≤!"); }
    }
    this.upd();
},

// –û–ë–ù–û–í–ò –ú–ï–¢–û–î upd() –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ù–û–í–´–• –î–ê–ù–ù–´–•
upd() {
    // ... —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ...
    
    // –ö—É–∑–Ω–∏—Ü–∞
    const swordBonus = this.s.swordLvl * 5;
    document.getElementById('sword-lvl-text').innerText = `–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ${this.s.swordLvl}`;
    document.getElementById('sword-boost-text').innerText = `–ë–æ–Ω—É—Å: +${swordBonus} ü™ô –∫ –∫–ª–∏–∫—É`;
    document.getElementById('forge-cost').innerText = (this.s.swordLvl + 1) * 500;
    
    // –†—ã–Ω–æ–∫
    document.getElementById('gem-buy-price').innerText = `${this.s.marketPrices.buy} ü™ô`;
    document.getElementById('gem-sell-price').innerText = `${this.s.marketPrices.sell} ü™ô`;
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω (–≤—ã–∑—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–∏ upd, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —á–∞—Å—Ç–æ –¥–µ—Ä–≥–∞–µ—Ç—Å—è)
    this.updateMarket();
    
    this.save();
}

// –í –º–µ—Ç–æ–¥–µ work() –∏–∑–º–µ–Ω–∏ —Ä–∞—Å—á–µ—Ç –∑–æ–ª–æ—Ç–∞, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞–ª—Å—è —É—Ä–æ–≤–µ–Ω—å –º–µ—á–∞:
// let g = (type === 'port' ? 2 : 1) + (this.s.swordLvl * 5);

