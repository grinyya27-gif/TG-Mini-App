 <!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>TGStat Mini</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --blue:#3b82f6;
  --bg:#020617;
  --card:rgba(255,255,255,.06);
  --text:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Arial;
  background:linear-gradient(160deg,#020617,#0f172a);
  color:var(--text);
}
.screen{display:none;padding:20px}
.show{display:block}
.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  margin:12px 0;
  backdrop-filter:blur(10px);
}
button,input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
}
button{
  background:linear-gradient(135deg,#3b82f6,#2563eb);
  color:white;
}
input{background:#020617;color:white;border:1px solid #1e293b}
.small{opacity:.7;font-size:14px}
.row{display:flex;justify-content:space-between}
</style>
</head>

<body>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div id="profile" class="screen show">
  <h1>üìä TGStat Mini</h1>
  <div class="card">
    üë§ <b id="username"></b><br>
    ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã—Ö: <b id="favCount"></b>
  </div>
  <button onclick="openSearch()">üîç –ü–æ–∏—Å–∫ –∫–∞–Ω–∞–ª–æ–≤</button>
</div>

<!-- –ü–û–ò–°–ö -->
<div id="search" class="screen">
  <h2>üîç –ü–æ–∏—Å–∫ –∫–∞–Ω–∞–ª–æ–≤</h2>
  <input id="query" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
  <button onclick="search()">–ù–∞–π—Ç–∏</button>

  <div id="results"></div>
  <button onclick="openProfile()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- –ö–ê–ù–ê–õ -->
<div id="channel" class="screen">
  <h2 id="chTitle"></h2>
  <p class="small">@<span id="chUser"></span></p>

  <div class="card row">
    <div>üë• <b id="chSubs"></b></div>
    <div>üìù <b id="chPosts"></b></div>
  </div>

  <div class="card">
    <canvas id="chart"></canvas>
  </div>

  <button onclick="toggleFav()">‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
  <button onclick="openSearch()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<script>
Telegram.WebApp.ready();

/* ---------- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ ---------- */
const tg = Telegram.WebApp.initDataUnsafe.user;
username.innerText = tg ? tg.first_name : "–ì–æ—Å—Ç—å";

/* ---------- –î–ê–ù–ù–´–ï ---------- */
const channels = [
  {
    id:1,
    title:"Crypto News",
    username:"crypto",
    subs:125000,
    posts:5400,
    stats:[100,200,500,900,1500,3000,5000,10000,20000,40000,80000,125000]
  },
  {
    id:2,
    title:"IT –ù–æ–≤–æ—Å—Ç–∏",
    username:"itnews",
    subs:87000,
    posts:3200,
    stats:[200,400,800,2000,4000,8000,16000,32000,60000,87000]
  },
  {
    id:3,
    title:"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",
    username:"marketing",
    subs:54000,
    posts:2100,
    stats:[1000,2000,5000,12000,24000,54000]
  }
];

let fav = JSON.parse(localStorage.getItem("fav")||"[]");
favCount.innerText = fav.length;

/* ---------- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---------- */
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("show"));
  document.getElementById(id).classList.add("show");
}
function openProfile(){show("profile")}
function openSearch(){show("search")}

/* ---------- –ü–û–ò–°–ö ---------- */
function search(){
  let q=query.value.toLowerCase();
  let r=channels.filter(c=>c.title.toLowerCase().includes(q));
  results.innerHTML="";
  r.forEach(c=>{
    results.innerHTML+=`
      <div class="card" onclick="openChannel(${c.id})">
        <b>${c.title}</b><br>
        <span class="small">@${c.username}</span>
      </div>`;
  });
}

/* ---------- –ö–ê–ù–ê–õ ---------- */
let current;
function openChannel(id){
  current=channels.find(c=>c.id===id);
  chTitle.innerText=current.title;
  chUser.innerText=current.username;
  chSubs.innerText=current.subs.toLocaleString();
  chPosts.innerText=current.posts;
  drawChart();
  show("channel");
}

function toggleFav(){
  if(!fav.includes(current.id)) fav.push(current.id);
  else fav=fav.filter(i=>i!==current.id);
  localStorage.setItem("fav",JSON.stringify(fav));
  favCount.innerText=fav.length;
  alert("–ì–æ—Ç–æ–≤–æ ‚≠ê");
}

/* ---------- –ì–†–ê–§–ò–ö ---------- */
function drawChart(){
  new Chart(document.getElementById("chart"),{
    type:"line",
    data:{
      labels:current.stats.map((_,i)=>i+1),
      datasets:[{
        label:"–ü–æ–¥–ø–∏—Å—á–∏–∫–∏",
        data:current.stats,
        borderColor:"#3b82f6",
        tension:.4
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{x:{display:false},y:{ticks:{color:"#94a3b8"}}}
    }
  });
}
</script>

</body>
</html>
