<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WAR SAGA: STABLE</title>
    <link href="https://fonts.googleapis.com/css2?family=Almendra:wght@400;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        :root { --gold: #ffcc00; --gold-dark: #b8860b; --parchment: #f4e4bc; --blood: #800000; }
        
        body { 
            background: #000; color: var(--parchment); 
            font-family: 'Almendra', serif; height: 100vh; 
            overflow: hidden; display: flex; flex-direction: column; 
        }

        /* –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ª–æ–∞–¥–µ—Ä –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ */
        #loader { 
            position: fixed; inset: 0; background: #000; 
            z-index: 9999; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
        }

        .header { background: #1a1a1a; border-bottom: 2px solid var(--gold-dark); padding: 15px; }
        .stats { display: flex; justify-content: space-around; font-weight: bold; font-size: 1.2em; }
        
        .main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .screen { display: none; }
        .active { display: block; }

        .card { 
            background: #111; border: 1px solid var(--gold-dark); 
            margin-bottom: 15px; padding: 15px; border-radius: 5px; 
            display: flex; justify-content: space-between; align-items: center;
        }

        .btn { 
            background: var(--blood); color: white; border: 1px solid var(--gold); 
            padding: 10px 15px; cursor: pointer; font-family: 'Cinzel', serif;
        }

        nav { 
            position: fixed; bottom: 0; width: 100%; height: 70px; 
            background: #000; border-top: 2px solid var(--gold-dark); 
            display: flex; justify-content: space-around; align-items: center;
        }

        .nav-item { color: #666; text-align: center; font-size: 0.8em; }
        .nav-active { color: var(--gold); }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –∑–æ–ª–æ—Ç–æ */
        .coin { position: fixed; color: var(--gold); font-weight: bold; pointer-events: none; animation: moveUp 0.8s forwards; }
        @keyframes moveUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div id="loader">
        <h1 style="color: var(--gold); font-family: 'Cinzel';">WAR SAGA</h1>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∏—Ä–∞...</p>
    </div>

    <header class="header">
        <div class="stats">
            <div>ü™ô <span id="gold">0</span></div>
            <div>üíé <span id="gems">0</span></div>
            <div>üéñÔ∏è <span id="lvl">1</span></div>
        </div>
    </header>

    <main class="main">
        <section id="scr-battle" class="screen active">
            <h2 style="text-align:center; margin-bottom:20px;">–ì–ï–†–û–ò–ß–ï–°–ö–ò–ï –¢–†–£–î–´</h2>
            <div class="card" onclick="game.tap('port', event)">
                <div><h3>–†—ã–±–∞–ª–∫–∞</h3><p>+2 ü™ô | +5 XP</p></div>
                <span>üé£</span>
            </div>
            <div class="card" onclick="game.tap('mine', event)">
                <div><h3>–†—É–¥–Ω–∏–∫</h3><p>+1 ü™ô | +10 XP</p></div>
                <span>‚õèÔ∏è</span>
            </div>
        </section>

        <section id="scr-shop" class="screen">
            <h2 style="text-align:center; margin-bottom:20px;">–ö–û–†–û–õ–ï–í–°–ö–ê–Ø –õ–ê–í–ö–ê</h2>
            <div class="card">
                <div><h3>–ú–µ—á</h3><p>+3 –∫ –∫–ª–∏–∫—É</p></div>
                <button class="btn" onclick="game.buy('sword', 300)">300 ü™ô</button>
            </div>
            <div class="card">
                <div><h3>–ö—Ä–µ—Å—Ç—å—è–Ω–∏–Ω</h3><p>+1 ü™ô / —Å–µ–∫</p></div>
                <button class="btn" onclick="game.hire(100)">100 ü™ô</button>
            </div>
        </section>
    </main>

    <nav>
        <div class="nav-item nav-active" onclick="game.tab('battle', this)">‚öîÔ∏è<br>–ë–ò–¢–í–ê</div>
        <div class="nav-item" onclick="game.tab('shop', this)">üí∞<br>–õ–ê–í–ö–ê</div>
    </nav>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        
        const game = {
            data: { gold: 50, gems: 0, lvl: 1, xp: 0, nx: 100, sword: false, workers: 0 },

            init() {
                // –ó–∞–≥—Ä—É–∑–∫–∞
                const saved = localStorage.getItem('war_saga_v3');
                if (saved) this.data = JSON.parse(saved);
                
                tg.expand();
                
                // –¢–∞–π–º–µ—Ä –¥–æ—Ö–æ–¥–∞
                setInterval(() => {
                    if (this.data.workers > 0) {
                        this.data.gold += this.data.workers;
                        this.update();
                    }
                }, 1000);

                // –£–±–∏—Ä–∞–µ–º –ª–æ–∞–¥–µ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ
                document.getElementById('loader').style.display = 'none';
                this.update();
            },

            tab(id, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
                document.getElementById('scr-' + id).classList.add('active');
                el.classList.add('nav-active');
            },

            tap(type, e) {
                let g = (type === 'port' ? 2 : 1) + (this.data.sword ? 3 : 0);
                this.data.gold += g;
                this.addXp(type === 'port' ? 5 : 10);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
                const p = document.createElement('div');
                p.className = 'coin'; p.innerText = '+' + g;
                p.style.left = (e.clientX || e.touches[0].clientX) + 'px';
                p.style.top = (e.clientY || e.touches[0].clientY) + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);

                this.update();
                tg.HapticFeedback.impactOccurred('medium');
            },

            addXp(v) {
                this.data.xp += v;
                if (this.data.xp >= this.data.nx) {
                    this.data.lvl++;
                    this.data.xp = 0;
                    this.data.nx = Math.floor(this.data.nx * 1.5);
                    tg.showAlert("–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: " + this.data.lvl);
                }
            },

            buy(id, p) {
                if (this.data[id]) return tg.showAlert("–£–∂–µ –µ—Å—Ç—å!");
                if (this.data.gold >= p) {
                    this.data.gold -= p;
                    this.data[id] = true;
                    this.update();
                } else { tg.showAlert("–ú–∞–ª–æ –∑–æ–ª–æ—Ç–∞!"); }
            },

            hire(p) {
                if (this.data.gold >= p) {
                    this.data.gold -= p;
                    this.data.workers++;
                    this.update();
                } else { tg.showAlert("–ú–∞–ª–æ –∑–æ–ª–æ—Ç–∞!"); }
            },

            update() {
                document.getElementById('gold').innerText = Math.floor(this.data.gold);
                document.getElementById('gems').innerText = this.data.gems;
                document.getElementById('lvl').innerText = this.data.lvl;
                localStorage.setItem('war_saga_v3', JSON.stringify(this.data));
            }
        };

        // –ó–∞–ø—É—Å–∫
        try {
            game.init();
        } catch(e) {
            alert("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: " + e);
        }
    </script>
</body>
</html>
