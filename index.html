<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>War Strategy Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a;
            --accent-red: #e63946;
            --accent-red-glow: rgba(230, 57, 70, 0.4);
            --text-main: #f1faee;
            --gray-text: #a8a8a8;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        /* HEADER & EXP */
        .header {
            background: #000;
            padding: 10px 15px;
            border-bottom: 1px solid var(--accent-red);
        }
        .res-row { display: flex; justify-content: space-around; margin-bottom: 10px; font-size: 1.2em; font-weight: bold; }
        .exp-bar-bg { width: 100%; height: 8px; background: #222; border-radius: 4px; overflow: hidden; }
        #exp-fill { height: 100%; background: var(--accent-red); width: 0%; transition: 0.4s; box-shadow: 0 0 10px var(--accent-red); }
        .lvl-label { display: block; text-align: center; font-size: 0.7em; color: var(--accent-red); margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* MAIN CONTENT */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .screen { display: none; flex-direction: column; gap: 15px; }
        .screen.active { display: flex; }

        /* SHOP CATEGORIES */
        .shop-tabs { display: flex; gap: 10px; margin-bottom: 10px; }
        .shop-tab { flex: 1; padding: 8px; background: #222; border: 1px solid #333; color: var(--gray-text); border-radius: 6px; font-size: 0.8em; text-align: center; cursor: pointer; }
        .shop-tab.active { background: var(--accent-red); color: white; border-color: var(--accent-red); }

        /* CARDS */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            display: flex; align-items: center; gap: 15px;
            border: 1px solid #2a2a2a;
            position: relative;
        }
        .card:active { border-color: var(--accent-red); }
        .card-icon { font-size: 2.2em; }
        .card-info { flex: 1; }
        .card-info h3 { margin: 0; font-size: 1em; color: #fff; }
        .card-info p { margin: 4px 0 0 0; font-size: 0.75em; color: var(--gray-text); line-height: 1.2; }
        
        .buy-btn {
            background: var(--accent-red);
            color: white; border: none; padding: 8px 12px;
            border-radius: 6px; font-weight: bold; font-size: 0.8em;
            cursor: pointer;
        }
        .buy-btn.bought { background: #333; color: #666; cursor: default; }

        /* BOTTOM NAV */
        .nav {
            position: fixed; bottom: 0; width: 100%;
            background: #000; border-top: 1px solid #222;
            display: flex; padding: 10px 0;
        }
        .nav-item { flex: 1; text-align: center; color: #555; font-size: 0.7em; }
        .nav-item.active { color: var(--accent-red); }
        .nav-item span { display: block; font-size: 1.8em; margin-bottom: 3px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <div class="res-row">
            <div>ü™ô <span id="gold">50</span></div>
            <div>üíé <span id="emeralds">0</span></div>
        </div>
        <div class="exp-bar-bg">
            <div id="exp-fill"></div>
        </div>
        <span class="lvl-label">–£—Ä–æ–≤–µ–Ω—å <span id="lvl">1</span> | <span id="xp-text">0/100</span> XP</span>
    </div>

    <div class="main-content">
        
        <div id="screen-work" class="screen active">
            <div class="card" onclick="game.doWork('port')">
                <div class="card-icon">üé£</div>
                <div class="card-info">
                    <h3>–†—ã–±–æ–ª–æ–≤–Ω—ã–π –ø–æ—Ä—Ç</h3>
                    <p>–î–æ—Ö–æ–¥: +<span id="port-gold">2</span> ü™ô | +5 XP</p>
                </div>
            </div>
            <div class="card" onclick="game.doWork('mine')">
                <div class="card-icon">‚õèÔ∏è</div>
                <div class="card-info">
                    <h3>–¢–µ–º–Ω—ã–π —Ä—É–¥–Ω–∏–∫</h3>
                    <p>–î–æ—Ö–æ–¥: +<span id="mine-gold">1</span> ü™ô | +10 XP</p>
                    <p style="color:var(--accent-red)">–®–∞–Ω—Å –Ω–∞ üíé: <span id="mine-chance">1</span>%</p>
                </div>
            </div>
        </div>

        <div id="screen-shop" class="screen">
            <div class="shop-tabs">
                <div class="shop-tab active" onclick="game.filterShop('rods', this)">–£–¥–æ—á–∫–∏</div>
                <div class="shop-tab" onclick="game.filterShop('pickaxes', this)">–ö–∏—Ä–∫–∏</div>
            </div>

            <div id="shop-rods" class="shop-cat">
                <div class="card">
                    <div class="card-icon">üéã</div>
                    <div class="card-info"><h3>–ë–∞–º–±—É–∫. —É–¥–æ—á–∫–∞</h3><p>–î–æ—Ö–æ–¥ –ø–æ—Ä—Ç–∞: +5 ü™ô</p></div>
                    <button id="btn-rod1" class="buy-btn" onclick="game.buy('rod1', 100)">100</button>
                </div>
                <div style="margin-top:10px" class="card">
                    <div class="card-icon">üé£</div>
                    <div class="card-info"><h3>–ü—Ä–æ—Ñ. —Å–Ω–∞—Å—Ç—å</h3><p>–î–æ—Ö–æ–¥ –ø–æ—Ä—Ç–∞: +15 ü™ô</p></div>
                    <button id="btn-rod2" class="buy-btn" onclick="game.buy('rod2', 500)">500</button>
                </div>
            </div>

            <div id="shop-pickaxes" class="shop-cat hidden">
                <div class="card">
                    <div class="card-icon">üî®</div>
                    <div class="card-info"><h3>–†–∂–∞–≤–∞—è –∫–∏—Ä–∫–∞</h3><p>–ó–æ–ª–æ—Ç–æ: +4 | –®–∞–Ω—Å üíé: 2%</p></div>
                    <button id="btn-pick1" class="buy-btn" onclick="game.buy('pick1', 150)">150</button>
                </div>
                <div style="margin-top:10px" class="card">
                    <div class="card-icon">üíé</div>
                    <div class="card-info"><h3>–ê–ª–º–∞–∑–Ω—ã–π –±—É—Ä</h3><p>–ó–æ–ª–æ—Ç–æ: +12 | –®–∞–Ω—Å üíé: 5%</p></div>
                    <button id="btn-pick2" class="buy-btn" onclick="game.buy('pick2', 800)">800</button>
                </div>
            </div>
        </div>

        <div id="screen-profile" class="screen">
            <div class="card">
                <div class="card-icon">üõ°Ô∏è</div>
                <div class="card-info">
                    <h3 id="user-name">–í–æ–∏–Ω</h3>
                    <p id="rank-text">–°—Ç–∞—Ç—É—Å: –ù–æ–≤–∏—á–æ–∫</p>
                    <p>–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤: <span id="total-clicks">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="game.setTab('work', this)"><span>‚öîÔ∏è</span>–†–∞–±–æ—Ç–∞</div>
        <div class="nav-item" onclick="game.setTab('shop', this)"><span>üí∞</span>–õ–∞–≤–∫–∞</div>
        <div class="nav-item" onclick="game.setTab('profile', this)"><span>üë§</span>–ì–µ—Ä–æ–π</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const game = {
            gold: 50, emeralds: 0, 
            lvl: 1, xp: 0, nextLvlXp: 100,
            clicks: 0,
            inventory: [],

            updateUI() {
                document.getElementById('gold').innerText = Math.floor(this.gold);
                document.getElementById('emeralds').innerText = this.emeralds;
                document.getElementById('lvl').innerText = this.lvl;
                document.getElementById('xp-text').innerText = `${this.xp}/${this.nextLvlXp}`;
                document.getElementById('exp-fill').style.width = (this.xp / this.nextLvlXp * 100) + '%';
                document.getElementById('total-clicks').innerText = this.clicks;

                // –ù–∞–≥—Ä–∞–¥—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–∞–±–æ—Ç—ã
                let portPlus = this.inventory.includes('rod2') ? 15 : (this.inventory.includes('rod1') ? 5 : 0);
                let minePlus = this.inventory.includes('pick2') ? 12 : (this.inventory.includes('pick1') ? 4 : 0);
                let chance = this.inventory.includes('pick2') ? 5 : (this.inventory.includes('pick1') ? 2 : 1);

                document.getElementById('port-gold').innerText = 2 + portPlus;
                document.getElementById('mine-gold').innerText = 1 + minePlus;
                document.getElementById('mine-chance').innerText = chance;
            },

            doWork(type) {
                this.clicks++;
                if (type === 'port') {
                    let bonus = this.inventory.includes('rod2') ? 15 : (this.inventory.includes('rod1') ? 5 : 0);
                    this.gold += (2 + bonus);
                    this.addXp(5);
                } else {
                    let bonus = this.inventory.includes('pick2') ? 12 : (this.inventory.includes('pick1') ? 4 : 0);
                    let chance = this.inventory.includes('pick2') ? 0.05 : (this.inventory.includes('pick1') ? 0.02 : 0.01);
                    this.gold += (1 + bonus);
                    if (Math.random() < chance) {
                        this.emeralds++;
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                    this.addXp(10);
                }
                tg.HapticFeedback.impactOccurred('medium');
                this.updateUI();
            },

            addXp(amount) {
                this.xp += amount;
                if (this.xp >= this.nextLvlXp) {
                    this.xp -= this.nextLvlXp;
                    this.lvl++;
                    // –£–º–Ω–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è —É—Ä–æ–≤–Ω—è: –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –Ω–∞ 40% —Å–ª–æ–∂–Ω–µ–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ + –±–∞–∑–æ–≤—ã–π –ø—Ä–∏—Ä–æ—Å—Ç
                    this.nextLvlXp = Math.floor(this.nextLvlXp * 1.4 + 50);
                    tg.showPopup({ title: '–£–†–û–í–ï–ù–¨ –ü–û–í–´–®–ï–ù!', message: `–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ ${this.lvl} —É—Ä–æ–≤–Ω—è!`, buttons: [{type: 'ok'}] });
                }
            },

            buy(id, price) {
                if (this.gold >= price && !this.inventory.includes(id)) {
                    this.gold -= price;
                    this.inventory.push(id);
                    const btn = document.getElementById('btn-' + id);
                    btn.innerText = "–ö–£–ü–õ–ï–ù–û";
                    btn.classList.add('bought');
                    tg.HapticFeedback.notificationOccurred('success');
                    this.updateUI();
                } else if (this.inventory.includes(id)) {
                    tg.showAlert("–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç!");
                } else {
                    tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!");
                }
            },

            setTab(name, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('screen-' + name).classList.add('active');
                el.classList.add('active');
            },

            filterShop(cat, el) {
                document.querySelectorAll('.shop-cat').forEach(c => c.classList.add('hidden'));
                document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
                document.getElementById('shop-' + cat).classList.remove('hidden');
                el.classList.add('active');
            }
        };

        if (tg.initDataUnsafe?.user) {
            document.getElementById('user-name').innerText = tg.initDataUnsafe.user.first_name;
        }

        game.updateUI();
    </script>
</body>
</html>
